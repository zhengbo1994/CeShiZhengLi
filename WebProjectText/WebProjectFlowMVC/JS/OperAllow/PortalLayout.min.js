function GetContentBlockById(n){return ContentBlock.GetById(n)}function LoadUserPortalData(n){ajax("FillData.ashx",{action:"GetUserPortalData",randData:(new Date).getTime()},"json",function(t){n(t)})}function LoadPortalLayout(n,t){ajax("FillData.ashx",{action:"GetPortalHtml",ppId:n,randData:(new Date).getTime()},"json",function(n){t(n.Success=="Y"&&n.Others[0]=="N"?n.Data:"")})}function ajaxLoading(){}var ContentType;(function(n){n[n.Normal=0]="Normal";n[n.FramePage=1]="FramePage";n[n.CustomContent=2]="CustomContent"})(ContentType||(ContentType={}));var QuickHelp=function(){function n(){var n=this;this.help=null;this.help=$(".quick-help");this.help.on("blur",function(){return n.help.hide()})}return n.Show=function(t,i){n._quickHelp===null&&(n._quickHelp=new n);var r=n._quickHelp.help;r.find("dt").text(t+"帮助");r.find("dd").html(i);r.show().focus()},n._quickHelp=null,n}(),CanvasView=function(){function n(){var r=this,i,t;this.canvas=n.Canvas=$(".canvas-view");n.TopHeader=$(".header");i=$(window);t=this;n.AutoBinding();i.on("resize",function(){n.Canvas.height(function(){return n.TopHeader.css("display")==="none"?i.height():i.height()-$(this).position().top-5})});this.canvas.on("click",".tab > .tab-pages > .tab-page",function(){var n=$(this);return n.addClass("sel").siblings(".tab-page").removeClass("sel"),n.closest(".tab").children(".tab-panel").hide().eq(n.index()).show(),!1}).on("click",".content-placeholder .title-func > .help",function(){var t=$(this),n=t.closest(".content-placeholder"),i=$.trim(n.attr("remark"));return QuickHelp.Show(n.find(".title .title-span").text(),i||"尚无任何帮助内容"),!1}).on("click",".content-placeholder .title-func > .refresh",function(){var e=$(this),n=e.closest(".content-placeholder"),r=Number(n.attr("contenttype")),i,u,t,f;return r===1?(i=n.find("> .content > .iframe-page"),u=i.attr("src"),i.attr("src","about:blank").attr("src",u),!1):r===2?(n.find(".content").html(n.find(".content").html()),!1):(t=n.find(".content-placeholder[contenttype=0]:visible"),f=n.parent("td").parent("tr").parent("tbody").parent("table.layout-table.tab").length>0,f||(t=t.add(n)),t.find(".content").empty().addClass("content-loading").append('<div class="loading-box"><img class="loading" src="../../image/loading.gif" alt="" /><\/div>'),t.each(function(){return ContentBlock.ParseContentBlock($(this)).LoadContent()}),!1)}).on("click",".content-placeholder > .title > .title-image",function(){var t=$(this).closest(".content-placeholder"),n=t.children(":not(.title,.setting)");return n.filter(":visible").length?(t.closest(".layout-table").parent().height(function(){return"auto"}),n.fadeOut(200).hide(200)):n.fadeIn(200).show(200),!1}).on("click",".content-placeholder .title-pager > a",function(){var n=$(this),t;n.attr("disabled","disabled");n.hasClass("sel")||(t=n.closest(".content-placeholder"),t.children(".content").attr("pageindex",n.attr("rel")),ContentBlock.ParseContentBlock(t).LoadContent(function(){return n.removeAttr("disabled")}))}).on("mouseover",".content-placeholder",function(){var n=$(this);return n.attr("contentscrolling")==="true"&&ContentScrolling.Pause(n),!1}).on("mouseleave",".content-placeholder",function(){var n=$(this);return n.attr("contentscrolling")==="true"&&ContentScrolling.Resume(n),!1});if(!RequestDataObject.GetDebug()){this.headerTab=n.HeadTabPage=$(".header .header-tab");this.headerTab.on("click","dd",function(){var i=$(this),f=i.attr("portalId"),e=i.attr("myId"),u=Number(i.attr("portalType")),o=$.trim(i.attr("url")),r=i.find(".down-menu-bar");i.addClass("sel").siblings().removeClass("sel");r.hide();r.find("li.selected").removeClass("selected");r.find("li[portalId='"+i.attr("portalId")+"']").addClass("selected");u===0&&r.find("li").length>1?t.canvas.addClass("fix-module"):t.canvas.removeClass("fix-module");n.LoadData(o,f,e,u)}).on("click","dd > a > .down-menu",function(){var t=$(this).closest("dd"),n=$(this).closest("dd").find(".down-menu-bar");return n.show(),n.find("li.selected").removeClass("selected"),n.find("li[myId='"+t.attr("myId")+"']").addClass("selected"),!1}).on("mouseleave","dd",function(){$(this).find(".down-menu-bar").hide()}).on("click","dd > .down-menu-bar li",function(){var n=$(this),t;n.hasClass("cn")?n.closest(".down-menu-bar").hide():(t=n.closest("dd"),n.addClass("selected").siblings().removeClass("selected"),t.attr("portalId",n.attr("portalId")),t.attr("myId",n.attr("myId")),t.attr("portalType",n.attr("portalType")),t.attr("url",n.attr("url")),t.find("a > span").text(n.text().replace(/\(.*?\)/g,"")),n.closest(".down-menu-bar").hide())});if(n.ShowSpecifyContentBlock){n.LoadSpecifyContentBlock();return}LoadUserPortalData(function(i){var u,h,y,l,o,w,s,a,v,b,k,c;if(i.Success&&i.Success.toLowerCase()==="y"&&(u=new Function("return "+i.Data)(),u&&u.length)){if(u.length===1&&u[0].list===undefined)h=u[0],t.canvas.css("top","0"),n.LoadData(h.url,h.ppid,h.id,Number(h.type));else{for(y in u)if(u.hasOwnProperty(y)){var f=u[y],e=f.list,p=e&&e.length>0,g=f.type==="1",d=$(n._portal_tab_tag_format.replace(/\{0\}/g,n.PrefixName(f.pname,Number(f.type))).replace(/\{1\}/g,f.ppid).replace(/\{2\}/g,f.id).replace(/\{3\}/g,f.type).replace(/\{4\}/g,n.HandlePortalUrl(f.url)).replace(/\{5\}/g,p?'<i class="down-menu"><\/i>':"").replace(/\{6\}/g,p?' class="down-menu-parent"':""));if(p){if(l=$(n._portal_down_menu_bar_format),g){o={};for(w in e)e.hasOwnProperty(w)&&(s=e[w],a=s.cname,o[a]||(o[a]=[]),o[a].push(n._portal_list_item_format.replace("{0}",s.pname).replace("{1}",s.ppid).replace("{2}",s.id).replace("{3}",f.type).replace("{4}",n.HandlePortalUrl(s.url))));for(v in o)o.hasOwnProperty(v)&&(b=o[v].join(""),$(n._portal_sub_level_format.replace("{0}",v).replace("{1}",b?"<ul>"+b+"<\/ul>":"")).appendTo(l))}else for(k in e)e.hasOwnProperty(k)&&(c=e[k],$(n._portal_list_item_format.replace("{0}",c.pname).replace("{1}",c.ppid).replace("{2}",c.id).replace("{3}",f.type).replace("{4}",n.HandlePortalUrl(c.url))).appendTo(l));l.appendTo(d)}d.appendTo(n.HeadTabPage)}$(".header").fadeIn(200);r.headerTab.find("dd:first").click();u.length===1&&(r.headerTab.addClass("only-person"),t.canvas.addClass("only-person"))}return}n.Canvas.empty().append(LoadingBox.CreateBigLoading("门户页加载失败 ...","../../image/big-info.png"))})}}return n.BindingNumber=function(){$("ul.number,ol.number").each(function(){var t=$(this),n,i,r,u;return t.data("loadcompleted")||(n=t.find("li"),n.each(function(n){var t=$(this),i=t.children("i,em");return i.length===0?t.html("<em>"+(n+1)+"<\/em>"+t.html()):i.text(n+1),t}),n.find("i:first-child,em:first-child").addClass("numberic"),n.length>0&&(i=n.eq(0).addClass("first")),n.length>1&&(r=n.eq(1).addClass("second")),n.length>2&&(u=n.eq(2).addClass("third")),t.data("loadcompleted",!0)),t})},n.AutoBinding=function(){n.BindingNumber()},n.PrefixName=function(t,i){var r=i===0?n._portal_tab_tag_normal_text_format:n._portal_tab_tag_prefix_text_format;return r.replace(/\{0\}/g,t).replace(/\{1\}/g,n._prefix[i])},n.HandlePortalUrl=function(n){return n?n+(n.indexOf("?")===-1?"?":"&")+"PortalType="+RequestDataObject.GetPortalType()+"&PortalOwnerID="+RequestDataObject.GetID():""},n.LoadData=function(t,i,r,u){t?n.LoadPortalLayoutInFrame(t):(RequestDataObject.SetData(i,r,u),n.ReLoadPortalLayout(i))},n.prototype.Init=function(){RequestDataObject.GetDebug()&&n.ReLoadPortalLayout(RequestDataObject.GetPortalId())},n.PrevProcess=function(t){var i=null,r,u;if(t){if(i=$(t),i.hasClass("empty-content"))return null;i.find(".setting").remove();i.find(".empty-content").remove();r=i.find(".content-placeholder > .title");r.find("> .title-func > .add").remove();r.find("> .title-image,> .title-span").attr("title","");i.find(".tab > .tab-pages > .add").remove();i.find(".title-func > a:not(.refresh,.help)").attr("href",function(){var t=$(this);return"javascript: openWindow('"+n.GetMoreUrl(t.attr("rel"))+"', "+t.attr("opensize")+" )"});i.hasClass("layout-table")||(u=$('<table class="layout-table ver"><tbody><tr><td><\/td><\/tr><\/tbody><\/table>'),u.find("td").append(i),i=u);i=$('<div class="normal-canvas-inner-wrap"><\/div>').append(i)}return i},n.LoadPortalLayoutInFrame=function(t){var r=$('<iframe src="'+t+'" frameborder="0" class="view-page-frame" scrolling="no"><\/iframe>'),u=LoadingBox.CreateBigLoading("正在加载页面 ..."),i;r.on("load",function(){u.remove();$(window).trigger("resize")});i=n.Canvas.removeClass("normal-canvas").empty();i.append(u);i.append(r);$(window).trigger("resize")},n.LoadSpecifyContentBlock=function(){var i=$.trim($("#hidID").val()),t;if(!i){n.Canvas.empty().append(LoadingBox.CreateBigLoading("提示：当前页面已失效。","../../../image/big-info.png"));return}t={id:"",contentBlockId:$.trim(getParamValue("id")),isShowTitle:$.trim(getParamValue("showtitle"))==="1"||!$.trim(getParamValue("showtitle")),title:$.trim(getParamValue("title")),titleBackgroundColor:$.trim(getParamValue("titlebg")),isShowIco:$.trim(getParamValue("showico"))==="1"||!$.trim(getParamValue("showico")),isShowPager:$.trim(getParamValue("showPager"))==="1"||!$.trim(getParamValue("showPager")),pagerPosition:$.trim(getParamValue("pagerpos")),funcPosition:$.trim(getParamValue("funcpos")),pageSize:Number($.trim(getParamValue("pagesize"))),pageIndex:Number($.trim(getParamValue("pageindex"))),isShowRefreshButton:$.trim(getParamValue("showrefresh"))==="1",refreshInterval:Number($.trim(getParamValue("refreshseconds"))),isAutoScroll:$.trim(getParamValue("scroll"))==="1",isShowMoreUrl:$.trim(getParamValue("showmore"))==="1"||!$.trim(getParamValue("showmore")),isShowOperatButton:$.trim(getParamValue("showopt"))==="1"||!$.trim(getParamValue("showopt"))};ajax("FillData.ashx",{action:"GetPortalBlock",PBID:t.contentBlockId,randData:(new Date).getTime()},"json",function(r){var f,u,e;if(r.Success.toLowerCase()==="y"&&(f=new Function("return "+r.Data+";")(),f&&f.length)){u=f[0];t.id=i.split(",")[Number(u.type)];t.pageIndex=isNaN(t.pageIndex)||t.pageIndex<1?1:t.pageIndex;t.pageSize=isNaN(t.pageSize)||t.pageSize<1?8:t.pageSize;RequestDataObject.SetData("",t.id,Number(u.type));e=$('<div class="content-placeholder specify-content-block'+(t.titleBackgroundColor?"":t.isShowTitle?" theme-gray":"")+'" contenttype="0" islist="'+u.list+'" ishead="'+u.head+'" minwidth="'+u.minwidth+'">'+(t.isShowTitle?'<div class="title" style="background-color: '+(t.titleBackgroundColor?t.titleBackgroundColor:"transparent")+'!important;">'+(t.isShowIco?'<img title="点击折叠内容块" class="title-image" alt="点击折叠内容块" src="'+u.ico+'"/>':"")+'<span class="title-span">'+(t.title?t.title:u.title)+"<\/span>"+(t.isShowOperatButton&&t.funcPosition!=="bottom"?'<div class="title-func">'+ContentBlock.LoadOptions(u.opts)+(t.isShowRefreshButton?'<a title="刷新" class="refresh" href="javascript:void(0)"><img alt="" src="../../image/refresh.png"/><span>刷新<\/span><\/a>':"")+(t.isShowMoreUrl?'<a class="more-link" href="javascript: openWindow(\''+n.GetMoreUrl(u.moreurl)+'\', 0, 0 )" rel="'+n.GetMoreUrl(u.moreurl)+'" opensize="0, 0"><img title="更多" alt="更多" src="../../image/more.png"/><span>更多<\/span><\/a>':"")+"<\/div>":"")+(t.isShowPager&&t.pagerPosition!=="bottom"?'<div class="title-pager"><\/div>':"")+"<\/div>":"")+'<div class="content" pagesize="'+t.pageSize+'" href="'+u.url+'" pageindex="'+t.pageIndex+'"><\/div>'+(t.isShowPager&&t.pagerPosition==="bottom"||t.isShowOperatButton&&t.funcPosition==="bottom"?'<div class="bottom">'+(t.isShowOperatButton&&t.funcPosition==="bottom"?'<div class="title-func">'+ContentBlock.LoadOptions(u.opts)+(t.isShowRefreshButton?'<a title="刷新" class="refresh" href="javascript:void(0)"><img alt="" src="../../image/refresh.png"/><span>刷新<\/span><\/a>':"")+(t.isShowMoreUrl?'<a class="more-link" href="javascript: openWindow(\''+n.GetMoreUrl(u.moreurl)+'\', 0, 0 )" rel="'+n.GetMoreUrl(u.moreurl)+'" opensize="0, 0"><img title="更多" alt="更多" src="../../image/more.png"/><span>更多<\/span><\/a>':"")+"<\/div>":"")+(t.isShowPager&&t.pagerPosition==="bottom"?'<div class="title-pager"><\/div>':"")+"<\/div>":"")+"<\/div>");e.appendTo(n.Canvas.empty());ContentBlock.ParseContentBlock(e).LoadContent();AutoRefresher.Initizal();return}n.Canvas.empty().append(LoadingBox.CreateBigLoading("提示：内容块加载失败。","../../image/big-info.png"))})},n.ComputMinWidth=function(t){var f=0,i,v,u,p,d,a,l,w,s;if(t.length)if(i=t.children(".layout-table"),v=12,i.length)if(i.hasClass("hor")){var y=i.find("> tbody > tr > td:first"),e=i.find("> tbody > tr > td:last"),o=y.width(),r=e.width(),b=n.ComputMinWidth(y),k=n.ComputMinWidth(e);o=o>b?o:b;r=r>k?r:k;u=y[0].style.width;u=u?u:"50%";u.toLowerCase()==="auto"||u.indexOf("%")===-1?(f=o+r,p=e[0].style.width.toLowerCase(),e&&e.length&&p.indexOf("px")!==-1&&(e.width(r),f-=r-Number(p.replace("px","")))):(d=o>r?o:r,f=Math.ceil(d*100/Number(u.replace("%",""))))}else{var tt=i.find("> tbody > tr:first > td"),it=i.find("> tbody > tr:last > td"),h=tt.width(),c=it.width(),g=n.ComputMinWidth(i.find("> tbody > tr:first > td")),nt=n.ComputMinWidth(i.find("> tbody > tr:last > td"));h=h>g?h:g;c=c>nt?c:nt;f=h>c?h:c}else{a=t.find(".content-placeholder").map(function(n,t){var u=$(t),r=u.width()+v,i=Number($(t).attr("minwidth"))+v;return i=isNaN(i)?0:i,i>r?i:r});l=0;for(w in a)a.hasOwnProperty(w)&&(s=a[w],s=isNaN(s)?0:s,l=l>s?l:s);f=l}return f},n.ReLoadPortalLayout=function(t){try{if(!t)return;var i=n.Canvas;RequestDataObject.GetDebug()||i.addClass("normal-canvas");i.empty().append(LoadingBox.CreateBigLoading("正在加载门户 ..."));LoadPortalLayout(t,function(t){var u,i,f,e;if(t=$.trim(t),u=n.PrevProcess(t),i=n.Canvas,i.empty(),u&&u.length)i.append(u);else{i.append(LoadingBox.CreateBigLoading("门户页为空或者不可用 ...","../../image/big-info.png"));return}f=$(window);n.Canvas.height(function(){return n.TopHeader.css("display")==="none"?f.height():f.height()-n.Canvas.position().top-5});e=i.find(".content-placeholder[contenttype=0]");e.find(".content").addClass("content-loading").append('<div class="loading-box"><img class="loading" src="../../image/loading.gif" alt="" /><\/div>');e.each(function(){return ContentBlock.ParseContentBlock($(this)).LoadContent()});var o=i.children(".normal-canvas-inner-wrap"),s=o.width()-17,r=n.ComputMinWidth(o)-18;r=r>s?r+18:r;o.css("min-width",Math.max(s,r));AutoRefresher.Initizal();TabPanelSetting.Apply()})}catch(r){}},n.GetMoreUrl=function(n){return n?n+(n.indexOf("?")===-1?"?":"&")+"PortalType="+RequestDataObject.GetPortalType()+"&PortalOwnerID="+RequestDataObject.GetID():""},n.ShowSpecifyContentBlock=!1,n.Style=$("#inlineStyle"),n.Header=$("head"),n.Body=$("body"),n._portal_tab_tag_format='<dd portalId="{1}" myId="{2}" class="portal-type-{3}" portalType="{3}" url="{4}"><a href="javascript: void(0)"{6}>{0}{5}<\/a><\/dd>',n._portal_tab_tag_normal_text_format="<span>{0}<\/span>",n._portal_tab_tag_prefix_text_format="{1} (<span>{0}<\/span>)",n._prefix=["","项目门户","企业门户"],n._portal_down_menu_bar_format='<ul class="down-menu-bar" />',n._portal_list_item_format='<li portalId="{1}" myId="{2}" portalType="{3}" url="{4}">{0}<\/li>',n._portal_sub_level_format='<li class="cn"><span>{0}<\/span>{1}<\/li>',n}(),TabPanelSetting=function(){function n(){}return n.Apply=function(){var n=$(".content-placeholder");n.removeClass("specify-content-placeholder");n.find("> .content .tab > .tab-panel > :only-child.content-placeholder").addClass("specify-content-placeholder")},n}(),AutoRefresher=function(){function n(){}return n.Initizal=function(){$("div.content-placeholder[contenttype=0][autorefresh=true]").each(function(){var t=$(this);return n.ApplyAutoRefresh(t,Number(t.attr("refreshinterval"))),t})},n.ApplyAutoRefresh=function(t,i){t&&t.hasClass("content-placeholder")&&(i=isNaN(i)||!i||i<60?60:i,n.CancelAutoRefresh(t),t.attr("timerHandleId",window.setInterval(function(){ContentBlock.ParseContentBlock(t).LoadContent()},i*1e3)))},n.CancelAutoRefresh=function(n){if(n&&n.hasClass("content-placeholder")){var t=Number(n.attr("timerHandleId"));isNaN(t)||window.clearInterval(t)}},n}(),ContentScrolling=function(){function n(){}return n.Scrolling=function(t){try{if(t.attr("contentscrolling")==="true"){var i=t.data("contentPart"),f=t.data("endheight"),r=i.scrollTop(),u=r;i.stop(!0,!0).animate({scrollTop:r+5},200,"linear",function(){i.scrollTop()===u&&i.stop().scrollTop(0);n.Scrolling(t)})}else n.CancelContentScrolling(t)}catch(e){}},n.ApplyContentScrolling=function(t){if(t&&t.hasClass("content-placeholder")){var i=t.children(".content"),u=i.height(),e=i.wrapInner(function(){return'<div class="content-wrap-inner"><\/div>'}).children(),f=t.children(".title"),r=t.height()-(f.length>0?f.height():0);i.height(r);e.css({height:u+r,paddingTop:r});t.data({endheight:u+r,contentPart:i});n.Scrolling(t)}},n.Pause=function(n){n&&n.hasClass("content-placeholder")&&n.children(".content").stop()},n.Resume=function(t){t&&t.hasClass("content-placeholder")&&n.Scrolling(t)},n.CancelContentScrolling=function(n){if(n&&n.hasClass("content-placeholder")){var t=n.children(".content"),i=t.children(".content-wrap-inner");i.length&&(t.stop().css({height:""}),i.children().unwrap())}},n}(),LoadingBox=function(){function n(){this.Big=$(".design-element > .big-loading-box");this.Small=$(".design-element > .loading-box")}return n.GetInstance=function(){return n._instance===null&&(n._instance=new n),n._instance},n.CreateBigLoading=function(t,i){var r=n.GetInstance().Big.clone();return r.find("span").text(t),i&&i.length&&r.find("img").attr("src",i),r},n.CreateSmallLoading=function(){return n.GetInstance().Small.clone()},n._instance=null,n}(),ContentBlock=function(){function n(){}return n.prototype.LoadComplete=function(n,t){t===void 0&&(t="");this.Content.removeClass("load-fail");var i=this.Content.children(".content"),r=i.empty().removeClass("content-loading").append(n).hide().fadeIn(500);i.find(".tab > .tab-pages > .tab-page:first").trigger("click");t!==""&&r.addClass(t);this.Content.siblings().length===0&&this.Content.height()<150&&this.Content.parent("td").height(function(){return"auto"})},n.prototype.LoadFail=function(){this.Content.addClass("load-fail");this.LoadComplete('<img src="../../image/warning.png" alt="" style="vertical-align: middle" /> 内容未能成功加载 ...');this.Content.children(".content").addClass("load-fail-bg")},n.prototype.PrevLoadResource=function(n,t){var i=[],r;if(n&&n.length)for(r in n)n.hasOwnProperty(r)&&(i=i.concat(this.LoadResource(n[r],t)));return i},n.prototype.FormatResourceString=function(n){return n.replace(/\r\n/g,"").replace('\\"','"')},n.prototype.LoadResource=function(t,i){var v=this,h,u,s,r,c,l,a;if(t=this.FormatResourceString(t),h=[],t&&(u=t.match(n._resource_format),u)){var f=[],e=[],o=[];for(s=0;s<u.length;s++)r=u[s],n._outline_script_format.test(r)&&f.push(r),n._inline_script_format.test(r)&&h.push(r),n._outline_style_format.test(r)&&e.push(r),n._inline_style_format.test(r)&&o.push(r);for(c in o)o.hasOwnProperty(c)&&CanvasView.Header.append(o[c]);for(l in e)e.hasOwnProperty(l)&&this.Content.queue(i,function(){$.get(e[l].match(n._outline_style_format)[1],undefined,function(t){$(n._style_format.replace(/\{0\}/,t)).on("load",function(){return v.Content.dequeue(i)}).appendTo(CanvasView.Header)},"text")});for(a in f)f.hasOwnProperty(a)&&this.Content.queue(i,function(){$.getScript(f[a].match(n._outline_script_format)[1],function(){return v.Content.dequeue(i)})})}return h},n.prototype.AfterLoadResource=function(t,i){var r,u;for(r in i)i.hasOwnProperty(r)&&(u=i[r].match(n._inline_script_format)[1].replace(/GetCurrentContentBlock\s*\(\s*\)/g,'$("div.content-placeholder[resourceindex='+t+']").data("reference")'),$.globalEval("try { "+u+" } catch (_error_message) {  } "))},n.LoadOptions=function(t){var e="",u=t,f,i,r;for(f in u)u.hasOwnProperty(f)&&(i=u[f],r=$.trim(i.ico),e+=n._func_link_tag.replace(/\{0\}/g,i.url).replace(/\{1\}/g,CanvasView.GetMoreUrl(i.url)).replace(/\{2\}/g,i.width).replace(/\{3\}/g,i.height).replace(/\{4\}/g,"").replace(/\{5\}/g,r?"":r).replace(/\{7\}/g,r?"":"hide").replace(/\{6\}/g,i.title));return e},n.prototype.UpdatePager=function(n,t,i,r){var e,h,f;if(!isNaN(t)&&(e=n.find(".title-pager"),e.length)){e.empty();var u=new Pager(t,i,r),o="",s='<a href="javascript: void(0)" rel="{1}"{2}>{0}<\/a>';if(u.recordCount){for(o+=s.replace("{0}",'<img src="../../image/first-page.png" alt="上一页" title="上一页" />').replace("{1}",u.prevPage.toString()).replace("{2}",' class="first-page'+(u.pageIndex===u.prevPage?" sel":"")+'"'),h=u.GetPageCodeInterval(3),f=h.start;f<=h.end;f++)o+=s.replace("{0}",f.toString()).replace("{1}",f.toString()).replace("{2}",f===u.pageIndex?' class="sel"':"");o+=s.replace("{0}",'<img src="../../image/last-page.png" alt="下一页" title="下一页" />').replace("{1}",u.nextPage.toString()).replace("{2}",' class="last-page'+(u.pageIndex===u.nextPage?" sel":"")+'"')}e.append(o)}},n.prototype.ReLoad=function(n){this.LoadContent(n)},n.prototype.GetId=function(){return this.Content.attr("resourceindex")},n.GetById=function(n){return $("div.content-placeholder[resourceindex="+n+"]").data("reference")},n.prototype.SetRequestParameter=function(n,t){var r=this.Content.children(".content"),u=r.attr("href");if(u){var f=u.split("?"),e=f[0],i=f[1]||"";i?new RegExp(n+"s*=").test(i)?i.replace(new RegExp(n+"s*=.*?(?:&|$)"),n+"="+t):i+="&"+n+"="+t:i=n+"="+t;r.attr("href",e+"?"+i)}},n.prototype.LoadContent=function(t){var r,u;try{var i=this,s="",f=this.Content.children(".content"),h=null,e=Number.NaN,c=Number.NaN,o=Number.NaN;s=f.attr("href");h=Number(this.Content.attr("contenttype"));e=Number(i.Content.attr("islist"));c=Number(i.Content.attr("ishead"));o=Number(i.Content.attr("minwidth"));e===1||i.Content.find(".title-pager").remove();!isNaN(o)&&o>0&&i.Content.css("min-width",o);switch(h){case 0:if(!s){i.LoadFail("");return}r=Number(f.attr("pagesize"));r=isNaN(r)||r<1?8:r;u=Number(f.attr("pageindex"));u=isNaN(u)||u<1?1:u;$.when($.ajax({url:s,dataType:"json",data:{IDAjax:!0,ID:RequestDataObject.GetID(),PortalType:RequestDataObject.GetPortalType(),PageSize:r,PageIndex:u,randData:(new Date).getTime()}})).done(function(u){var o,s;u&&u.Success&&u.Success.toLowerCase()==="y"?(o=i.Content.attr("resourceindex"),o||(o="ResourceLoader"+String(n.ResourceIndex++),i.Content.attr("resourceindex",o).data("reference",i)),s=i.PrevLoadResource(u.Others,o),i.Content.queue(o,function(){i.LoadComplete(u.Data);i.Content.dequeue(o)}).queue(o,function(){i.AfterLoadResource(o,s);i.Content.dequeue(o)}).queue(o,function(){e===1&&i.UpdatePager(i.Content,Number(u.Others[1]),r,Number(u.Others[0]));i.Content.dequeue(o)}).queue(o,function(){e===1&&f.css("min-height",(r+(f.find("> .table > thead").length>0?1:0))*30+"px");i.Content.attr("contentscrolling")==="true"&&ContentScrolling.ApplyContentScrolling(i.Content);i.Content.dequeue(o)}).queue(o,function(){t&&$.isFunction(t)&&t();i.Content.dequeue(o)}).dequeue(o)):i.LoadFail(u)}).fail(function(n){i.LoadFail(n)});return;case 1:this.LoadComplete('<iframe class="iframe-page" src="about:blank" frameborder="0"><\/iframe>');return;case 2:this.LoadComplete("","custom-content-block");return}i.LoadFail("")}catch(l){}},n.ParseContentBlock=function(t){var i=new n;return i.Content=t,i},n._default_content_image="../../image/content-default.png",n._default_content_title="尚无标题",n._resource_format=/(\<style.*?\>.*?\<\/style\>)|(\<link.*?\>)|(\<script.*?\>.*?\<\/script\>)/ig,n._outline_script_format=/\<script.*?src\s*\=\s*['"]+(.*?)['"]+.*?\>.*?\<\/script\>/i,n._inline_script_format=/\<script.*?\>(.*?)\<\/script\>/i,n._outline_style_format=/\<link.*?href\s*\=\s*['"]+(.*?)['"]+.*?\>/i,n._inline_style_format=/\<style.*?\>(.*?)\<\/style\>/i,n._outline_style_tag='<link rel="stylesheet" href="{0}" />',n.ResourceIndex=0,n._style_format='<style type="text/css">{0}<\/style>',n._func_link_tag='<a href="javascript: openWindow(\'{1}\', {2}, {3})" rel="{0}" opensize="{2}, {3}" class="{4}"><img src="{5}" class="{7}" title="{6}" alt="{6}" /><span>{6}<\/span><\/a>',n}(),Pager=function(){function n(n,t,i){this.pageIndex=n;this.pageSize=t;this.recordCount=i;this.prevPage=0;this.nextPage=0;this.pageCount=0;this.pageIndex=isNaN(this.pageIndex)||this.pageIndex<1?1:this.pageIndex;this.pageSize=isNaN(this.pageSize)||this.pageSize<1?1:this.pageSize;this.recordCount=isNaN(this.recordCount)||this.recordCount<0?0:this.recordCount;this.Comput()}return n.prototype.Comput=function(){if(this.recordCount===0){this.pageCount=this.pageIndex=this.prevPage=this.nextPage=1;return}this.pageCount=Math.ceil(this.recordCount/this.pageSize);this.pageCount=this.pageCount<1?1:this.pageCount;this.pageIndex=this.pageIndex>this.pageCount?this.pageCount:this.pageIndex;this.prevPage=this.pageIndex<=1?1:this.pageIndex-1;this.nextPage=this.pageIndex>=this.pageCount?this.pageCount:this.pageIndex+1},n.prototype.GetMidValue=function(n){return n%2!=0?(n+1)/2:n/2},n.prototype.GetStartCode=function(n,t){return this.pageIndex+t>this.pageCount?this.pageIndex-(n-(this.pageCount-this.pageIndex+1)):this.pageIndex-(t-1)},n.prototype.GetEndCode=function(n,t){var i=this.pageIndex<t?n:this.pageIndex+t-1;return i>this.pageCount?this.pageCount:i},n.prototype.GetPageCodeInterval=function(n){var t,i;return n=n>1?n:1,t={start:1,end:1},n<=1?(t.start=this.pageIndex,t.end=this.pageIndex):(i=this.GetMidValue(n),t.start=this.GetStartCode(n,i),t.end=this.GetEndCode(n,i)),t.start=t.start<1?1:t.start,t.end=t.end<1?1:t.end,t},n}(),RequestDataObject=function(){function n(){}return n.SetData=function(t,i,r){n._id=i;n._portalId=t;n._portalType=r},n.GetID=function(){if(!n._id){var t=document.location.search.match(/id\=(.*?)(?:&|$)/i);n._id=t?t[1]:null}return n._id},n.GetDebug=function(){var n=document.location.search.match(/systemdebug\=(.*?)(?:&|$)/i);return n?n[1].toLowerCase()==="true":!1},n.GetPortalType=function(){if(isNaN(n._portalType)){var t=document.location.search.match(/portaltype\=(\d+?)(?:&|$)/i);n._portalType=t?Number(t[1]):Number.NaN}return n._portalType},n.GetPortalId=function(){if(!n._portalId){var t=document.location.search.match(/portal\=(.*?)(?:&|$)/i);n._portalId=t?t[1]:null}return n._portalId},n._id=null,n._portalType=Number.NaN,n._portalId=null,n}();$(function(){return(new CanvasView).Init()});