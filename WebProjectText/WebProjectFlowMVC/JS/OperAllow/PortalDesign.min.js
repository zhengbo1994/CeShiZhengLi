function GetContentBlockById(n){return Sapi.PortalDesign.ContentBlock.GetById(n)}function LoadPortalLayout(n,t){ajax("FillData.ashx",{action:"GetPortalHtml",PPID:n,randData:(new Date).getTime()},"json",function(n){t(n.Success==="Y"&&n.Others[0]==="N"?n.Data:"")})}function SavePortalLayout(n,t,i){ajax("FillData.ashx",{action:"SavePortalHtml",PPID:n,Html:t,randData:(new Date).getTime()},"json",function(n){i(n.Success==="Y")})}function ajaxLoading(){}var Sapi;(function(n){var t;(function(n){var ut,ft,et,u,b,c,k,d,g,nt,l,pt,f,r;(function(n){n[n.Normal=0]="Normal";n[n.FramePage=1]="FramePage";n[n.CustomContent=2]="CustomContent";n[n.ImageContent=3]="ImageContent"})(ut||(ut={})),function(n){n[n.Percent=0]="Percent";n[n.Pixel=1]="Pixel"}(ft||(ft={})),function(n){n[n.Unknown=-1]="Unknown";n[n.Left=0]="Left";n[n.Right=1]="Right";n[n.Up=2]="Up";n[n.Down=3]="Down"}(et||(et={}));u=function(){function n(){this.DesignPanel=new c;this.ReviewPanel=new at;var n=$(".design-box > dt");this.designPage=n.children(".design-page");this.reviewPage=n.children(".review-page")}return n.prototype.Init=function(){this.DesignPanel.Init();var r=this;this.designPage.click(function(){$(this).addClass("sel").siblings(".review-page").removeClass("sel");r.ReviewPanel.Hide();r.DesignPanel.Show();n.Resizable=!0;t.DoResizeInterval()});this.reviewPage.click(function(){n.Resizable=!1;$(this).addClass("sel").siblings(".design-page").removeClass("sel");r.DesignPanel.Hide();r.ReviewPanel.BuildReview(c.CanvasStatic.GetFinalOutputHTML())});ajax("FillData.ashx",{action:"GetPortalBlock",PortalType:i.GetPortalType(),randData:(new Date).getTime()},"json",$.proxy(this.DesignPanel.OperatControl.ContentBlocks.LoadContentBlocks,this.DesignPanel.OperatControl.ContentBlocks));ajax("FillData.ashx",{action:"GetPortalBlockGroup",PortalType:i.GetPortalType(),randData:(new Date).getTime()},"json",$.proxy(this.DesignPanel.OperatControl.ContentBlockGroups.LoadContentGroups,this.DesignPanel.OperatControl.ContentBlockGroups))},n.Resizable=!0,n.Style=$("#inlineStyle"),n.Header=$("head"),n.Body=$("body"),n}();n.DesignView=u;b=function(){function n(){}return n.getInstance=function(){var i,r,u;if(n.dialog===null){i=n.dialog=$(".color-scheme-box");r=$(window);r.on("resize scroll",function(){i.css("display")!=="none"&&i.stop().animate({left:(r.width()-i.width())/2,top:(r.height()-i.height())/2+r.scrollTop()},300,"swing")});u=i.find(".color-picker");u.spectrum({showInput:!0,showInitial:!0,showPalette:!0,showAlpha:!0,preferredFormat:"hex",palette:[["rgb(0, 0, 0)","rgb(67, 67, 67)","rgb(102, 102, 102)","rgb(153, 153, 153)","rgb(183, 183, 183)","rgb(204, 204, 204)","rgb(217, 217, 217)","rgb(239, 239, 239)","rgb(243, 243, 243)","rgb(255, 255, 255)"],["rgb(152, 0, 0)","rgb(255, 0, 0)","rgb(255, 153, 0)","rgb(255, 255, 0)","rgb(0, 255, 0)","rgb(0, 255, 255)","rgb(74, 134, 232)","rgb(0, 0, 255)","rgb(153, 0, 255)","rgb(255, 0, 255)"],["rgb(230, 184, 175)","rgb(244, 204, 204)","rgb(252, 229, 205)","rgb(255, 242, 204)","rgb(217, 234, 211)","rgb(208, 224, 227)","rgb(201, 218, 248)","rgb(207, 226, 243)","rgb(217, 210, 233)","rgb(234, 209, 220)","rgb(221, 126, 107)","rgb(234, 153, 153)","rgb(249, 203, 156)","rgb(255, 229, 153)","rgb(182, 215, 168)","rgb(162, 196, 201)","rgb(164, 194, 244)","rgb(159, 197, 232)","rgb(180, 167, 214)","rgb(213, 166, 189)","rgb(204, 65, 37)","rgb(224, 102, 102)","rgb(246, 178, 107)","rgb(255, 217, 102)","rgb(147, 196, 125)","rgb(118, 165, 175)","rgb(109, 158, 235)","rgb(111, 168, 220)","rgb(142, 124, 195)","rgb(194, 123, 160)","rgb(166, 28, 0)","rgb(204, 0, 0)","rgb(230, 145, 56)","rgb(241, 194, 50)","rgb(106, 168, 79)","rgb(69, 129, 142)","rgb(60, 120, 216)","rgb(61, 133, 198)","rgb(103, 78, 167)","rgb(166, 77, 121)","rgb(133, 32, 12)","rgb(153, 0, 0)","rgb(180, 95, 6)","rgb(191, 144, 0)","rgb(56, 118, 29)","rgb(19, 79, 92)","rgb(17, 85, 204)","rgb(11, 83, 148)","rgb(53, 28, 117)","rgb(116, 27, 71)","rgb(91, 15, 0)","rgb(102, 0, 0)","rgb(120, 63, 4)","rgb(127, 96, 0)","rgb(39, 78, 19)","rgb(12, 52, 61)","rgb(28, 69, 135)","rgb(7, 55, 99)","rgb(32, 18, 77)","rgb(76, 17, 48)"]]});i.find(".btn-cancel").on("click",function(){return n.Close()});i.find(".btn-apply-all,.btn-apply").on("click",function(){var t=i.data("target"),u=t.find(".content-placeholder"),r,f;t.hasClass("content-placeholder")&&(u=t);r=n.GetColorScheme();f=$.parseJSON(r);t.hasClass("design-canvas")&&(t.attr("oldColorScheme",t.attr("colorscheme")),t.attr("colorscheme",r));u.each(function(t,i){var u=$(i);u.attr("oldColorScheme",u.attr("colorscheme"));u.attr("colorscheme",r);n.Apply(u,f)});n.Close()});i.find(".btn-recover").on("click",function(){var r=i.data("target"),t=$.trim(r.attr("oldColorScheme"));t&&n.ReSetColor($.parseJSON(t))});i.find(".btn-apply-page-bg-color").on("click",function(){var r=i.data("target"),u=n.GetColorScheme(),t=$.parseJSON(u);r.css("background-color",t.PageBgColor).children().css("background-color",t.PageBgColor)});i.find(".btn-set-global-default").on("click",function(){if(t.Canvas.attr("colorscheme",$(this).closest(".color-scheme-box").data("target").attr("colorscheme")),confirm("是否确信设为全局颜色预设？")){var r=i.data("target");i.data("target",t.Canvas);i.find(".btn-apply-all").trigger("click");n.Close()}})}return n.dialog},n.GetColorScheme=function(){var i=n.getInstance(),t="{";return t+='"PageBgColor": "'+i.find(".page-bg-color").val()+'",',t+='"ContentBgColor": "'+i.find(".content-bg-color").val()+'",',t+='"ContentBorderColor": "'+i.find(".content-border-color").val()+'",',t+='"TitleBgColor": "'+i.find(".title-bg-color").val()+'",',t+='"TitleFgColor": "'+i.find(".title-color").val()+'",',t+='"TitleLinkColor": "'+i.find(".title-link-color").val()+'",',t+='"TextColor": "'+i.find(".text-color").val()+'"',t+"}"},n.Apply=function(n,t){n.removeClass("theme-blue theme-gray theme-tran");n.css("cssText","background-color: "+t.ContentBgColor+"; border-color: "+t.ContentBorderColor+"; color: "+t.TextColor+" !important;");var i=n.children(".title");i.css("cssText","background-color: "+t.TitleBgColor+" !important; background-image: url(../../image/content-back.png);");i.find(".title-span").css("cssText","color: "+t.TitleFgColor+" !important;");n.find(".title-func a").css("cssText","color: "+t.TitleLinkColor+" !important;")},n.ReSetColor=function(t){var i=n.getInstance();i.find(".page-bg-color").spectrum("set",t.PageBgColor);i.find(".content-bg-color").spectrum("set",t.ContentBgColor);i.find(".content-border-color").spectrum("set",t.ContentBorderColor);i.find(".title-bg-color").spectrum("set",t.TitleBgColor);i.find(".title-color").spectrum("set",t.TitleFgColor);i.find(".title-link-color").spectrum("set",t.TitleLinkColor);i.find(".text-color").spectrum("set",t.TextColor)},n.Show=function(i){var f;i===void 0&&(i=t.Canvas);var u=$(window),r=n.getInstance(),e=!1;r.find(".setting-dialog-btns :not(.btn-cancel,.btn-recover)").hide();r.find(".page-background-color-setting").hide();i.hasClass("design-canvas")?(r.find(".dialog-title").text("全局颜色预设"),r.find(".page-background-color-setting").show(),r.find(".btn-apply-all").show(),e=!0):(r.find(".dialog-title").text("内容块颜色预设"),r.find(".btn-set-global-default,.btn-apply").show());f=i.attr("colorscheme");n.ReSetColor(f?$.parseJSON(f):n.GetSchemeByTarget(i,e));r.data("target",i).show().stop().animate({left:(u.width()-r.width())/2,top:(u.height()-r.height())/2+u.scrollTop()-50},300,"swing")},n.GetSchemeByTarget=function(n,t){var r,i,u;return t===void 0&&(t=!1),r=n,i="{",t&&(r=n.find(".content-placeholder:eq(0)"),i+='"PageBgColor": "'+n.css("background-color")+'",'),i+='"ContentBgColor": "'+r.css("background-color")+'",',i+='"ContentBorderColor": "'+r.css("border-color")+'",',i+='"TitleLinkColor": "'+r.find(".title-func a:first").css("color")+'",',i+='"TextColor": "'+r.css("color")+'",',u=r.children(".title"),i+='"TitleBgColor": "'+u.css("background-color")+'",',i+='"TitleFgColor": "'+u.find(".title-span").css("color")+'"',i+="}",n.attr("colorscheme",i),$.parseJSON(i)},n.Close=function(){n.getInstance().hide()},n.dialog=null,n.target=null,n}();c=function(){function n(){var u=this;this.panel=$(".design-box > .design-panel");this.inner=$(".design-panel-inner");this.copyButton=$(".design-load-layout-from");this.reload=$(".design-refresh-all-cb");this.colorScheme=$(".design-color-scheme");this.copyDialog=$(".layout-copy-selector");this.selectCopyButton=this.copyDialog.find(".layout-copy-selector-btns-ok");this.cancelCopyButton=this.copyDialog.find(".layout-copy-selector-btns-cancel");this.selectCopyList=this.copyDialog.find(".layout-copy-selector-list");this.copyDialogPortalTitle=this.copyDialog.find(".layout-copy-selector-target i");this.copyDialogPortalTitle.text(["个人门户","项目门户","企业门户"][i.GetPortalType()]);this.copyDialog.on("click",".layout-copy-selector-list > li",function(){$(this).addClass("sel").siblings().removeClass("sel")});var f=$(window),o=this.copyDialog.height(),e=this.copyDialog.width();f.on("resize scroll",function(){u.copyDialog.css("display")!=="none"&&u.copyDialog.stop().animate({left:(f.width()-e)/2,top:(f.height()-o)/2+f.scrollTop()},300,"swing")});this.copyButton.on("click",function(){$(".setting-dialog").hide();u.selectCopyList.children("li").removeClass("sel");u.copyDialog.css({left:(f.width()-e)/2,top:0}).show();f.trigger("resize")});this.reload.on("click",function(){$(".setting-dialog").hide();$(".content-placeholder[contenttype]:visible").each(function(){var n=$(this),t=n.find(".content"),u=Number(n.attr("contenttype")),i,f;return u===1?(i=n.find("> .content > .iframe-page"),f=i.attr("src"),i.attr("src","about:blank").attr("src",f),n):u===2?(t.html(t.html()),n):(t.empty().addClass("content-loading").append('<div class="loading-box"><img onerror="imgError()" class="loading" src="../../image/loading.gif" alt="" /><\/div>'),r.ParseContentBlock(n).LoadContent(),n)})});this.colorScheme.on("click",function(){$(".setting-dialog").hide();b.Show()});this.cancelCopyButton.on("click",function(){return u.copyDialog.hide()});this.selectCopyButton.on("click",function(){var n,i;u.copyDialog.hide();n=u.selectCopyList.children(".sel");n.length&&(i=$.trim(n.attr("rel")),i&&t.ReLoadPortalLayout(i))});this.LoadPortalList();n.CanvasStatic=this.Canvas=new t;this.OperatControl=new k}return n.prototype.Init=function(){this.Canvas.Init(this.inner);this.OperatControl.Init()},n.prototype.Hide=function(){this.panel.hide();this.copyButton.hide();this.reload.hide();this.colorScheme.hide()},n.prototype.Show=function(){this.panel.fadeIn(1e3);this.copyButton.fadeIn(500);this.reload.fadeIn(500);this.colorScheme.fadeIn(500)},n.prototype.LoadPortalList=function(){var n=this;ajax("FillData.ashx",{action:"GetPortalPageList",PortalType:i.GetPortalType(),randData:(new Date).getTime()},"json",function(t){t.Success==="Y"&&n.BuildPortalList(new Function("return "+t.Data+";")())})},n.prototype.BuildPortalList=function(n){var t;delete n[i.GetPortalId()];for(t in n)n.hasOwnProperty(t)&&this.selectCopyList.append('<li rel="{0}">{1}<\/li>'.replace("{0}",t).replace("{1}",n[t]))},n}();n.DesignPanel=c;var at=function(){function n(){var n=this;this.panel=$(".design-box > .review-panel");this.reviewFrame=$(".review-page-frame");this.win=$(window.parent);this.innerWin=$(window);this.win.on("resize",function(){try{n.reviewFrame.height(n.innerWin.height()-n.reviewFrame.position().top-20)}catch(t){}});this.reviewFrame.on("load",function(){return n.win.trigger("resize")})}return n.prototype.Hide=function(){this.panel.hide()},n.prototype.BuildReview=function(n){var r=this,t;e.HideAll();t=yt.CreateBigLoading("正在保存布局 ...","../../image/big-loading.gif");this.panel.empty().append(t).fadeIn(1e3);SavePortalLayout(i.GetPortalId(),n,function(n){if(n)r.reviewFrame.attr("src","../../home/portal/portal.html?systemdebug=true&portal="+i.GetPortalId()+"&id="+i.GetID()+"&portalType="+i.GetPortalType()),r.panel.empty().append(r.reviewFrame);else{var u=t.find("span"),f=t.find("img");f.attr("src","../../image/big-info.png");u.text("保存布局失败 ...")}})},n}(),vt=function(){function n(){var n=this;this.help=null;this.help=$(".quick-help");this.help.on("blur",function(){return n.help.hide()})}return n.Show=function(t,i){n._quickHelp===null&&(n._quickHelp=new n);var r=n._quickHelp.help;r.find("dt").text(t+"帮助");r.find("dd").html(i);r.show().focus()},n._quickHelp=null,n}(),t=function(){function n(){this.canvas=n.Canvas=$(".design-panel-inner .design-canvas");this.layout=n.GroundLayout=new f(this.canvas);this.operatControlBox=$(".operat-control-box");n.AutoBinding()}return n.BindingNumber=function(){$("ul.number,ol.number").each(function(){var t=$(this),n,i,r,u;return t.data("loadcompleted")||(n=t.find("li"),n.each(function(n){var t=$(this),i=t.children("i,em");return i.length===0?t.html("<em>"+(n+1)+"<\/em>"+t.html()):i.text(n+1),t}),n.find("i:first-child,em:first-child").addClass("numberic"),n.length>0&&(i=n.eq(0).addClass("first")),n.length>1&&(r=n.eq(1).addClass("second")),n.length>2&&(u=n.eq(2).addClass("third")),t.data("loadcompleted",!0)),t})},n.AutoBinding=function(){n.BindingNumber()},n.HiddenElement=function(){rt.Hide();w.Reset();p.Reset();ht.Hide()},n.GetMoreUrl=function(n){return n?n+(n.indexOf("?")===-1?"?":"&")+"PortalType="+i.GetPortalType()+"&PortalOwnerID="+i.GetID():""},n.PrevProcess=function(t){var i=null;return t&&(i=$(t),i.find(".title-func > a:not(.refresh,.help)").attr("href",function(){var t=$(this);return"javascript: openWindow('"+n.GetMoreUrl(t.attr("rel"))+"', "+t.attr("opensize")+" )"})),i},n.HtmlInitialize=function(t,i){var u,e;i=$.trim(i);u=n.PrevProcess(i);i&&t.removeClass("init-size");t.empty();u&&u.length?t.append(u):t.append(n.EmptyContent);t.find(".layout-table").each(function(){var n=$(this);return new f(n,"").ActiveLayout(),n});e=t.find(".content-placeholder[contenttype]");e.filter("[contenttype=0]").find(".content").addClass("content-loading").append('<div class="loading-box"><img onerror="imgError()" class="loading" src="../../image/loading.gif" alt="" /><\/div>');e.each(function(){var n=$(this),t=r.ParseContentBlock(n);return Number(n.attr("contenttype"))===0&&t.LoadContent(),r.ActiveDroppable(t),n});n.GroundLayout.ActiveLayout();y.Initizal();s.Apply()},n.ReLoadPortalLayout=function(t){LoadPortalLayout(t,function(t){return n.HtmlInitialize(n.Canvas,t)})},n.prototype.Init=function(t){var f=this,s=this;this.operatControlBox.on("blur",function(){return f.operatControlBox.hide()});this.operatControlBox.on("mouseenter",function(){return f.operatControlBox.off("blur")});this.operatControlBox.on("mouseleave",function(){f.operatControlBox.on("blur",function(){return f.operatControlBox.hide()}).focus()});this.operatControlBox.find(".icon-only").on("click",function(){var n=s.operatControlBox.data("target"),t=$(this);n&&n.length&&(t.attr("checked")?n.children("img").show():n.children("img").hide())});this.operatControlBox.find(".text-only").on("click",function(){var n=s.operatControlBox.data("target"),t=$(this);n&&n.length&&(t.attr("checked")?n.children("span").show():n.children("span").hide())});this.operatControlBox.find(".input").on("keyup",function(){var n=s.operatControlBox.data("target");n&&n.length&&n.find("span").text(this.value)});this.operatControlBox.find(".hide-operat-button").on("click",function(){var n=s.operatControlBox.data("target");n&&n.length&&n.hide();s.operatControlBox.hide()});this.canvas.hide().width(t.width()-210).show();this.canvas.on("resize",function(){return f.canvas.stop().animate({width:t.width()-210},300,"swing"),u.Resizable=!0,!1});$(window).on("resize",function(){n.HiddenElement();o.ReSet();f.canvas.trigger("resize")}).resize();setInterval(function(){u.Resizable&&(n.Canvas.find(".layout-table > tbody > tr > td:visible").trigger("resize"),n.Canvas.trigger("resize"))},1e3);n.ReLoadPortalLayout(i.GetPortalId());this.canvas.on("dblclick","td",function(){var n,t,r,i;return this.getAttribute("splitter")==="hor"&&(this.nextSibling||this.previousSibling)&&(n=$(this),t=Number(this.getAttribute("sizeunit")),t=isNaN(t)?0:t,r=t===0?1:0,this.setAttribute("sizeunit",r),i=n.siblings(),r===1?(n.addClass("pixel").width(n.width()),Number(i.attr("sizeunit"))===1&&i.attr("sizeunit",0).removeClass("pixel")):n.removeClass("pixel").width(function(){return Math.floor((n.width()+5)/n.parent().width()*100)+"%"}),i.width(function(){return"auto"})),!1}).on("mouseenter","td > .empty-content",function(){return u.Resizable&&rt.Anchor($(this)),!1}).on("mouseout","td > .empty-content",function(){return u.Resizable&&rt.Hide(),!1}).on("dblclick",".content-placeholder",function(){return!1}).on("mouseenter",".content-placeholder",function(){return ht.Anchor($(this)),!1}).on("dblclick",".content-placeholder > .title > .title-span",function(){var n=$(this),t=n.offset();return ct.Anchor(n,{left:t.left,top:t.top+4},{width:n.width()+10,height:20},null,"content-placeholder-title-editing"),!1}).on("mouseenter",".content-placeholder > .content .iframe-page",function(){return p.Reset(),w.Anchor($(this)),!1}).on("mouseout",".content-placeholder > .content .iframe-page",function(){return w.Reset(),!1}).on("mouseenter",".content-placeholder > .content.custom-content-block",function(){return w.Reset(),p.Anchor($(this)),!1}).on("mouseout",".content-placeholder > .content.custom-content-block",function(){return p.Reset(),!1}).on("click",".content-placeholder > .setting",function(){var n=$(this);return bt.Anchor(n.closest(".content-placeholder"),n),!1}).on("click",".content-placeholder .title-func > .help",function(){var i=$(this),t=i.closest(".content-placeholder"),r=$.trim(t.attr("remark"));return n.HiddenElement(),vt.Show(t.find(".title .title-span").text(),r||"尚无任何帮助内容"),!1}).on("click",".content-placeholder .title-func > .refresh",function(){var o=$(this),n=o.closest(".content-placeholder"),u=Number(n.attr("contenttype")),i,f,t,e;return u===1?(i=n.find("> .content > .iframe-page"),f=i.attr("src"),i.attr("src","about:blank").attr("src",f),!1):u===2?(n.find(".content").html(n.find(".content").html()),!1):(t=n.find(".content-placeholder[contenttype=0]:visible"),e=n.parent("td").parent("tr").parent("tbody").parent("table.layout-table.tab").length>0,e||(t=t.add(n)),t.find(".content").empty().addClass("content-loading").append('<div class="loading-box"><img onerror="imgError()" class="loading" src="../../image/loading.gif" alt="" /><\/div>'),t.each(function(){return r.ParseContentBlock($(this)).LoadContent()}),!1)}).on("mouseover",".content-placeholder .title-func > a",function(){var t=$(this),n=s.operatControlBox,i=t.children("span");return n.find(".icon-only").attr("checked",(t.children("img").css("display")!=="none").toString()),n.find(".text-only").attr("checked",(i.css("display")!=="none").toString()),n.find(".input").val(i.text()),n.data("target",t),n.show().position({of:t,offset:"0 5",my:"center top",at:"center bottom"}).focus(),!1}).on("click",".content-placeholder > .title > .title-image",function(){var t=$(this).closest(".content-placeholder"),n=t.children(":not(.title,.setting)");return n.filter(":visible").length?(t.closest(".layout-table").parent().height(function(){return"auto"}),n.fadeOut(200).hide(200)):n.fadeIn(200).show(200),!1}).on("click",".content-placeholder .title-pager > a",function(){var n=$(this),t;n.attr("disabled","disabled");n.hasClass("sel")||(t=n.closest(".content-placeholder"),t.children(".content").attr("pageindex",n.attr("rel")),r.ParseContentBlock(t).LoadContent(function(){return n.removeAttr("disabled")}))}).on("mouseover",".content-placeholder",function(){var n=$(this);return n.attr("contentscrolling")==="true"&&a.Pause(n),!1}).on("mouseleave",".content-placeholder",function(){var n=$(this);return n.attr("contentscrolling")==="true"&&a.Resume(n),!1}).on("resize",".layout-table > tbody > tr > td",function(){var i,n,o,s,h;if(!u.Resizable)return!1;var r=$(this),t=r,f=this,c=r.children();try{if(i=f.getAttribute("splitter"),i){if(i==="ver"&&(t=$(f=f.parentElement)),!f.nextSibling)return;n=t.data("splitter");n&&n.length!==0||(n=e.CreateSplitter(t,i));o=st[i];i==="hor"?(n.height(t.height()-10),s=r.parent(),h=n.position().top,n.draggable("option","containment",[r.position().left+50,h,s.position().left+s.width()-50,h])):n.width(t.width()-10);n.position({of:t,offset:o.offset,my:o.my,at:o.at}).show()}}catch(l){}return!1});lt.ApplyBinding()},n.DoResizeInterval=function(){u.Resizable&&(n.Canvas.find(".layout-table > tbody > tr > td:visible").trigger("resize"),n.Canvas.trigger("resize"))},n.prototype.GetFinalOutputHTML=function(n){n===void 0&&(n=this.canvas);var t=n.clone(),i=t.find(".content-placeholder").removeAttr("resourceindex").removeClass("load-fail").css({"min-height":""}).filter("[contenttype=0]"),r=i.find(".content");return r.each(function(n,t){var i=$(t);i.attr("href",i.attr("originalHref"))}),r.removeAttr("style").removeAttr("originalHref").removeClass("load-fail-bg content-loading").html(""),i.find(".title-pager").html(""),t.html()},n.EmptyContent='<div class="empty-content"><\/div>',n}();n.DesignCanvas=t;k=function(){function n(){this.isLoad=!1;this.control=$(".design-panel-control");this.tabs=$(".design-panel-control h3 > span");this.contentHeader=$(".design-control-layout-content-header");this.OperatButtons=new d;this.LayoutElementSelector=new g;this.ContentBlocks=new nt;this.ContentBlockGroups=new l}return n.prototype.Init=function(){var n=this,t=$(window);t.on("scroll",function(){if(n.isLoad){var i=t.scrollTop();n.control.stop().animate({top:i>51?i-41:0},500,"easeInOutQuint")}});this.control.fadeIn(300,function(){t.trigger("scroll")});this.isLoad=!0;this.tabs.click(function(){$(this).addClass("sel").siblings("span").removeClass("sel")});this.contentHeader.click(function(){n.LayoutElementSelector.Active()});this.OperatButtons.Init();this.LayoutElementSelector.Init();this.ContentBlocks.Init();this.ContentBlockGroups.Init()},n}();n.OperatControl=k;d=function(){function n(){this.btns=$(".design-panel-control .operat-box a");this.undo=this.btns.filter(".undo");this.redo=this.btns.filter(".redo");this.clean=this.btns.filter(".clean");this.save=this.btns.filter(".save")}return n.prototype.Init=function(){this.btns.mousedown(function(){$(this).css({opacity:.5})}).mouseup(function(){$(this).css({opacity:1})});this.undo.on("click",function(){alert("正在开发中 ...")});this.redo.on("click",function(){alert("正在开发中 ...")});this.clean.on("click",function(){var n=$(t.EmptyContent);e.DeleteAll("");t.Canvas.empty().append(n);f.ActiveDroppable(n)});this.save.on("click",function(){SavePortalLayout(i.GetPortalId(),c.CanvasStatic.GetFinalOutputHTML(),function(n){n?alert("保存成功。"):alert("保存失败。")})})},n}();n.OperatButtonArea=d;g=function(){function n(){this.normalPage=$(".design-panel-control .select-layout-element");this.complexPage=$(".design-panel-control .select-complex-layout-element");this.elementBox=$(".design-control-layout-element");this.elements=this.elementBox.children("li");this.defaultElements=this.elementBox.children(".default");this.complexElements=this.elementBox.children(".complex")}return n.prototype.Init=function(){var n=this;this.normalPage.click(function(){n.elementBox.animate({height:80},500,"easeInOutQuint");n.defaultElements.fadeIn(500);n.complexElements.hide()});this.complexPage.click(function(){n.elementBox.animate({height:420},500,"easeInOutQuint");n.defaultElements.hide();n.complexElements.fadeIn(500)});this.elements.draggable({addClasses:!1,appendTo:"#layout-dragging-shelter",helper:"clone",opacity:.7,revert:"invalid",scroll:!1,start:function(){t.HiddenElement();o.ReSet()},drag:function(){},stop:function(){}})},n.prototype.Active=function(){this.normalPage.click()},n}();n.LayoutElementArea=g;nt=function(){function n(){var i=this,u;this.block=$(".design-control-layout-contents");this.search=$(".design-panel-control .search-content-input");this.categoryButton=$(".design-panel-control .search-choose-category");this.categoryListBox=$(".design-panel-control .search-choose-categories-box");this.prompt=$(".content-block-prompt");this.contentPreview=$(".content-block-preview");this.iconOnleyButton=$(".search-content-input-box .show-style .only-icon-style");this.detailButton=$(".search-content-input-box .show-style .detail-style");var n=this,f=$(".content-block-tab-panel"),e=$(".content-block-group-tab-panel");$(".select-content").on("click",function(){f.show();e.hide()});$(".select-content-group").on("click",function(){f.hide();e.show()});this.iconOnleyButton.on("click",function(){var t=$(this);t.hasClass("sel")||(n.detailButton.removeClass("sel"),t.addClass("sel"),n.getContents().removeClass("detail-list"))}).addClass("sel");this.detailButton.on("click",function(){var t=$(this);t.hasClass("sel")||(n.iconOnleyButton.removeClass("sel"),t.addClass("sel"),n.getContents().addClass("detail-list"))});this.prompt.on("mouseenter",function(){return i.prompt.hide()});u=Number.NaN;this.contentPreview.on("blur",function(){i.contentPreview.hide()});this.block.on("mouseenter","li",function(){var t=$(this),i=t.offset(),r;n.prompt.text(t.attr("rel"));r=(n.prompt.width()-t.width())/2;i.left-=r;i.top+=t.height()+12;n.prompt.css(i).fadeIn(100);window.clearTimeout(u);u=window.setTimeout(function(){return n.prompt.hide()},7e3)}).on("mouseleave mousedown","li",function(){i.prompt.hide()}).on("dblclick","li",function(){var u=$(this),e=n.contentPreview.find(".preview").empty().text("正在加载 ..."),i,f;n.contentPreview.children(".preview-title").text("预览 - "+u.find("span").text());n.contentPreview.show().focus().position({of:u,offset:"0 0",my:"right bottom",at:"right top"});i=new r(u,function(){var f=i.Template.option.minwidth,r=i.Content.find(".tab");r.length&&(r.find("> .tab-pages > .tab-page:eq(0)").addClass("sel"),r.children(".tab-panel:eq(0)").show());e.empty().width(f>400?f:400).append(i.Content);s.Apply();t.DoResizeInterval();n.contentPreview.position({of:u,offset:"0 0",my:"right bottom",at:"right top"})});i&&i.Content&&i.Template.contentType!==0&&(f=i.Template.option.minwidth,e.empty().width(f>400?f:400).append(i.Content),s.Apply(),t.DoResizeInterval(),n.contentPreview.position({of:u,offset:"0 0",my:"right bottom",at:"right top"}))})}return n.prototype.getContents=function(){return this.block.find("li")},n.prototype.categoryListBoxSetting=function(){var n=this,t=this;this.categoryButton.click(function(){n.categoryListBox.css("display")==="none"?(n.categoryListBox.slideDown(200),n.categoryListBox.focus()):n.categoryListBox.slideUp(200)});this.categoryListBox.focusout(function(){n.categoryButton.trigger("click")});this.categoryListBox.on("click","li",function(){var n=this.getAttribute("typename");return t.search.val(n?"["+$.trim(this.innerText)+"] 分类":"").triggerHandler("keyup"),n?t.search.triggerHandler("focus"):(t.search.triggerHandler("focusout"),t.categoryButton.focus()),!1})},n.prototype.searchTextBoxSetting=function(){var n=this;this.search.focus(function(){$(this).addClass("search-content-input-focus").select()}).focusout(function(){$.trim(this.value)||$(this).removeClass("search-content-input-focus")}).keyup(function(){var t=$.trim(this.value),r=n.getContents(),i;t?(i=t.match(/\[(.+?)\]/),r.hide().filter(i?"[typename='"+$.trim(i[1])+"']":"[rel*='"+t+"']").show()):r.show()})},n.prototype.ActiveContentBlockDraggable=function(){var n=this.prompt;this.getContents().draggable({addClasses:!1,appendTo:"#content-dragging-shelter",helper:"clone",opacity:.7,revert:"invalid",scroll:!1,start:function(i,r){n.hide();t.HiddenElement();o.ReSet();h.Create(r.helper)},drag:function(t,i){n.hide();h.UpdateIndicator(i.offset)},stop:function(){h.Reset();n.hide()}})},n.prototype.Init=function(){this.categoryListBoxSetting();this.searchTextBoxSetting();tt.InitSystemTemplate()},n.prototype.addCategory=function(t){this.categoryListBox.find("li[typename='"+t+"']").length===0&&this.categoryListBox.append(n._category_format.replace(/\{0\}/g,t))},n.prototype.LoadContentBlocks=function(t){var f,r,u;if(t.Success&&t.Success.toUpperCase()==="Y"){if(f="",r=new Function("return "+t.Data+";")(),r&&r.length){for(u=0;u<r.length;u++){var i=r[u],e=i.typename?$.trim(i.typename):"系统",o=tt.Push(new v(0,i));f+=n._format.replace(/\{0\}/g,i.title).replace(/\{1\}/g,i.ico).replace(/\{2\}/g,e).replace(/\{3\}/g,o.toString()).replace(/\{4\}/g,"["+e+"]").replace(/\{5\}/g,i.remark||"");this.addCategory(e)}this.block.append(f);this.ActiveContentBlockDraggable()}}else this.block.append(t.Data)},n._category_format='<li typename="{0}">{0}<\/li>',n._format='<li dropType="2" rel="{0} {4}" remark="{5}" typename="{2}" template="{3}"><img onerror="imgError()" src="{1}" alt="" /><span>{0}<\/span><\/li>',n}();n.ContentBlockArea=nt;l=function(){function n(){this.block=$(".content-block-group-tab-panel");n.blockStatic=$(".design-control-layout-content-group-box");this.search=this.block.find(".search-content-group-input");this.groupBox=n.groupBoxStatic=this.block.find(".design-control-layout-content-group")}return n.prototype.Init=function(){var n=this;this.search.on("focusin",function(){$(this).addClass("search-content-input-focus").select()}).on("focusout",function(){$.trim(this.value)||$(this).removeClass("search-content-input-focus")}).on("keyup",function(){var t=$.trim(this.value),i=n.groupBox.children("li");t?i.hide().filter(":contains("+t+")").show():i.show()})},n.CreateGroup=function(t,r){t&&ajax("FillData.ashx",{action:"SavePortalBlockGroupHtml",PortalType:i.GetPortalType(),PBGName:t,Html:r,Remark:"",randData:(new Date).getTime()},"json",function(i){i?i.Success!=="Y"?alert(i.Data):($(".select-content-group").trigger("click"),n.BuildGroupItem(n.groupBoxStatic,{title:t,html:r,remark:""},!0),n.blockStatic.stop().animate({scrollTop:n.groupBoxStatic.height()},"fast","swing")):alert("创建内容块组失败！")})},n.GetGroupData=function(t){var i,r;for(i in n.GroupData)if(n.GroupData&&n.GroupData.hasOwnProperty(i)&&(r=n.GroupData[i],r.key===t))return r;return null},n.GenerateKey=function(){return String((new Date).getTime())+String(Math.floor(Math.random()*1e6))},n.HasKey=function(t){return n.GetGroupData(t)!==null},n.GenerateUniqueKey=function(){var t=n.GenerateKey();return n.HasKey(t)?n.GenerateUniqueKey():t},n.ApplyDraggable=function(n){n.draggable({addClasses:!1,appendTo:"#content-group-dragging-shelter",helper:"clone",opacity:.7,revert:"invalid",scroll:!1,start:function(){},drag:function(){},stop:function(){}})},n.BuildGroupItem=function(t,i,r){r===void 0&&(r=!1);i.key=n.GenerateUniqueKey();var u=$(n.format.replace(/\{0\}/g,i.key).replace(/\{1\}/g,i.title));u.appendTo(t);r&&(n.GroupData.push(i),n.ApplyDraggable(u))},n.prototype.LoadContentGroups=function(t){var i,r,u;if(t)if(t.Success=="Y"){if(i=new Function("return "+t.Data+";")(),i&&i.length>0){n.GroupData=i;for(r in i)i.hasOwnProperty(r)&&(u=i[r],$.trim(u.html)&&n.BuildGroupItem(this.groupBox,u));n.ApplyDraggable(this.groupBox.find("li"))}}else alert(t.Data)},n.groupBoxStatic=null,n.blockStatic=null,n.format='<li dropType="3" key="{0}">{1}<\/li>',n.GroupData=null,n}();n.ContentBlockGroupArea=l;var y=function(){function n(){}return n.Initizal=function(){$("div.content-placeholder[contenttype=0][autorefresh=true]").each(function(){var t=$(this);return n.ApplyAutoRefresh(t,Number(t.attr("refreshinterval"))),t})},n.ApplyAutoRefresh=function(t,i){t&&t.hasClass("content-placeholder")&&(i=isNaN(i)||!i||i<60?60:i,n.CancelAutoRefresh(t),t.attr("timerHandleId",window.setInterval(function(){r.ParseContentBlock(t).LoadContent()},i*1e3)))},n.CancelAutoRefresh=function(n){if(n&&n.hasClass("content-placeholder")){var t=Number(n.attr("timerHandleId"));isNaN(t)||window.clearInterval(t)}},n}(),a=function(){function n(){}return n.Scrolling=function(t){try{if(t.attr("contentscrolling")==="true"){var i=t.data("contentPart"),f=t.data("endheight"),r=i.scrollTop(),u=r;i.stop(!0,!0).animate({scrollTop:r+5},200,"linear",function(){i.scrollTop()===u&&i.stop().scrollTop(0);n.Scrolling(t)})}else n.CancelContentScrolling(t)}catch(e){}},n.ApplyContentScrolling=function(t){if(t&&t.hasClass("content-placeholder")){var i=t.children(".content"),u=i.height(),e=i.wrapInner(function(){return'<div class="content-wrap-inner"><\/div>'}).children(),f=t.children(".title"),r=t.height()-(f.length>0?f.height():0);i.height(r);e.css({height:u+r,paddingTop:r});t.data({endheight:u+r,contentPart:i});n.Scrolling(t)}},n.Pause=function(n){n&&n.hasClass("content-placeholder")&&n.children(".content").stop()},n.Resume=function(t){t&&t.hasClass("content-placeholder")&&n.Scrolling(t)},n.CancelContentScrolling=function(n){if(n&&n.hasClass("content-placeholder")){var t=n.children(".content"),i=t.children(".content-wrap-inner");i.length&&(t.stop(),i.children().unwrap())}},n}(),v=function(){function n(n,t){this.contentType=n;this.option=t}return n}();n.ContentBlockTemplate=v;var tt=function(){function n(){}return n.Push=function(t){var i=n._list,r=i.length;return t.TemplateIndex=r,i.push(t),r},n.GetTemplate=function(t){return n._list[t]},n.InitSystemTemplate=function(){n.Push(new v(1,{title:"框架页面",typename:"系统",ico:"../../image/default-page.png",list:0,head:0,minwidth:0,url:"",opts:null}));n.Push(new v(2,{title:"自定义内容块",typename:"系统",ico:"../../image/content-page.png",list:0,head:0,minwidth:0,url:"",opts:null}));n.Push(new v(3,{title:"图片内容块",typename:"系统",ico:"../../image/content-image.png",list:0,head:0,minwidth:0,url:"",opts:null}))},n._list=[],n}(),ot=function(){function n(){this.initLayoutDefineList()}return n.GetInstance=function(){return n._instance===null&&(n._instance=new n),n._instance},n.prototype.initLayoutDefineList=function(){this.LayoutList={hor:'<table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table>',ver:'<table class="layout-table ver"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table>',tab:'<table class="layout-table tab"><tbody><tr><td><div class="content-placeholder theme-gray"><img onerror="imgError()" class="setting" src="../../image/setting.png" alt="" /><div class="title"><img onerror="imgError()" class="title-image" src="../../image/content-default.png" alt="" /><span class="title-span">标题<\/span><div class="title-func"><a href="javascript:void(0)" class="refresh" title="刷新"><img onerror="imgError()" src="../../image/refresh.png" alt="" /><span>刷新<\/span><\/a><\/div><div class="title-pager"><\/div><\/div><div class="content"><dl class="tab"><dt class="tab-pages"><a class="tab-page sel" hidefocus href="javascript:void(0)">标签1<\/a><a class="tab-page" hidefocus href="javascript:void(0)">标签2<\/a><a class="tab-page" hidefocus href="javascript:void(0)">标签3<\/a><a class="add" href="javascript:void(0)"><img onerror="imgError()" src="../../image/add.gif" title="添加" alt="添加" /><\/a><\/dt><dd class="tab-panel layout-top"><div class="empty-content"><\/div><\/dd><dd class="tab-panel layout-top"><div class="empty-content"><\/div><\/dd><dd class="tab-panel layout-top"><div class="empty-content"><\/div><\/dd><\/dl><\/div><\/div><\/td><\/tr><\/tbody><\/table>',"complex-3col":'<table class="layout-table hor complex-3col"><tbody><tr><td splitter="hor" style="width: 33%;"><div class="empty-content"><\/div><\/td><td splitter="hor"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table>',"complex-a":'<table class="layout-table ver complex-a"><tbody><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table>',"complex-b":'<table class="layout-table ver complex-b"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table>',"complex-c":'<table class="layout-table hor complex-c"><tbody><tr><td splitter="hor"><table class="layout-table ver"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table>',"complex-d":'<table class="layout-table hor complex-d"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><table class="layout-table ver"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table>',"complex-e":'<table class="layout-table hor complex-e"><tbody><tr><td splitter="hor"><table class="layout-table ver"><tbody><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table>',"complex-f":'<table class="layout-table hor complex-f"><tbody><tr><td splitter="hor"><table class="layout-table ver"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table>',"complex-g":'<table class="layout-table hor complex-g"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><table class="layout-table ver"><tbody><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table>',"complex-h":'<table class="layout-table hor complex-h"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><table class="layout-table ver"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table>',"complex-i":'<table class="layout-table ver complex-i"><tbody><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor" style="width: 33%;"><div class="empty-content"><\/div><\/td><td splitter="hor"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><\/tr><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table>',"complex-j":'<table class="layout-table ver complex-j"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor" style="width: 33%;"><div class="empty-content"><\/div><\/td><td splitter="hor"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table>',"complex-k":'<table class="layout-table hor complex-k"><tbody><tr><td splitter="hor"><table class="layout-table ver"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><table class="layout-table ver"><tbody><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table>',"complex-l":'<table class="layout-table hor complex-l"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><table class="layout-table ver"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><table class="layout-table ver"><tbody><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table>',"complex-m":'<table class="layout-table ver complex-m"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><table class="layout-table ver"><tbody><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor" style="width: 33%;"><div class="empty-content"><\/div><\/td><td splitter="hor"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><\/tr><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table>',"complex-n":'<table class="layout-table hor complex-n"><tbody><tr><td splitter="hor"><table class="layout-table ver"><tbody><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><tr><td splitter="ver"><table class="layout-table ver"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table>',"complex-o":'<table class="layout-table hor complex-o"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><table class="layout-table ver"><tbody><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><tr><td splitter="ver"><table class="layout-table ver"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table>',"complex-p":'<table class="layout-table ver complex-p"><tbody><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><table class="layout-table ver"><tbody><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table>',"complex-q":'<table class="layout-table ver complex-q"><tbody><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><table class="layout-table ver"><tbody><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><\/tr><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table>',"complex-r":'<table class="layout-table ver complex-r"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><table class="layout-table ver"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table>',"complex-s":'<table class="layout-table ver complex-s"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><table class="layout-table ver"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table>',"complex-t":'<table class="layout-table ver complex-t"><tbody><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor" style="width: 33%;"><div class="empty-content"><\/div><\/td><td splitter="hor"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><\/tr><tr><td splitter="ver"><table class="layout-table ver"><tbody><tr><td splitter="ver"><div class="empty-content"><\/div><\/td><\/tr><tr><td splitter="ver"><table class="layout-table hor"><tbody><tr><td splitter="hor" style="width: 33%;"><div class="empty-content"><\/div><\/td><td splitter="hor"><table class="layout-table hor"><tbody><tr><td splitter="hor"><div class="empty-content"><\/div><\/td><td splitter="hor"><div class="empty-content"><\/div><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table><\/td><\/tr><\/tbody><\/table>'}},n.GetLayout=function(t){var i=n.GetInstance().LayoutList[t];return i?new f($(i),t):null},n._instance=null,n}(),yt=function(){function n(){this.Big=$(".design-element > .big-loading-box");this.Small=$(".design-element > .loading-box")}return n.GetInstance=function(){return n._instance===null&&(n._instance=new n),n._instance},n.CreateBigLoading=function(t,i){var r=n.GetInstance().Big.clone();return r.find("span").text(t),i&&i.length&&r.find("img").attr("src",i),r},n.CreateSmallLoading=function(){return n.GetInstance().Small.clone()},n._instance=null,n}(),it=function(){function n(){this.Left=$(".resize-cover.cover-left");this.Right=$(".resize-cover.cover-right");this.LeftValueText1=this.Left.find(".size-value");this.LeftValueText2=this.Left.find(".other-size-value");this.LeftUnitText1=this.Left.find(".size-unit");this.LeftUnitText2=this.Left.find(".other-size-unit");this.RightValueText1=this.Right.find(".size-value");this.RightValueText2=this.Right.find(".other-size-value");this.RightUnitText1=this.Right.find(".size-unit");this.RightUnitText2=this.Right.find(".other-size-unit")}return n.Create=function(t,i,r){n._instance===null&&(n._instance=new n);var u=n._instance;u.Left.css(t).show();u.Right.css(t).show();i===0?(u.LeftPercentText=u.LeftValueText1,u.LeftPixelText=u.LeftValueText2,u.LeftUnitText1.text("%"),u.LeftUnitText2.text("px")):(u.LeftPercentText=u.LeftValueText2,u.LeftPixelText=u.LeftValueText1,u.LeftUnitText1.text("px"),u.LeftUnitText2.text("%"));r===0?(u.RightPercentText=u.RightValueText1,u.RightPixelText=u.RightValueText2,u.RightUnitText1.text("%"),u.RightUnitText2.text("px")):(u.RightPercentText=u.RightValueText2,u.RightPixelText=u.RightValueText1,u.RightUnitText1.text("px"),u.RightUnitText2.text("%"))},n.Covering=function(t,i){var r=n._instance;r&&(r.Left.css(t.option),r.LeftPercentText.text(t.percent),r.LeftPixelText.text(t.option.width.toString()),r.Right.css(i.option),r.RightPercentText.text(100-t.percent),r.RightPixelText.text(i.option.width.toString()))},n.Stop=function(){n._instance&&(n._instance.Left.hide(),n._instance.Right.hide())},n._instance=null,n}(),e=function(){function n(){this.container=$(".layout-splitter-box");this.splitterElement=$(".design-element .layout-splitter");this.container.on("click",".layout-splitter > .buttons > li.first",function(){var i=$(this),t=i.closest(".layout-splitter"),n=t.data("attach");return n&&n.length&&o.Attach(t.hasClass("hor")?n:n.children()),!1}).on("click",".layout-splitter > .buttons > li.second",function(){var r=$(this),t=r.closest(".layout-splitter"),n=t.data("attach"),i;return n&&n.length&&(i=t.hasClass("hor")?n.next():n.next().children(),o.Attach(i)),!1}).on("click",".layout-splitter > .buttons > li.third",function(){var t=$(this),i=t.closest(".layout-splitter"),n=i.data("attach");return n&&n.length&&o.Attach(n.closest(".layout-table").parent()),!1}).on("click",".layout-splitter > .buttons > li.fourth",function(){var u,e;o.ReSet();var s=$(this),h=s.closest(".layout-splitter"),t=h.data("attach");if(t&&t.length){n.DeleteAll("");var i=t.next(),c=t.children().clone(),l=i.children().clone();t.empty().append(l);i.empty().append(c);u=t.add(i);u.find(".content-placeholder[contenttype]").each(function(){return r.ActiveDroppable(r.ParseContentBlock($(this))),s});e=u.find(".empty-content");e.length&&f.ActiveDroppable(e)}return!1})}return n.prototype.CreateSplitter=function(n,i){var r=this.splitterElement.clone(!0,!0),f;return r.addClass(i),r.data("attach",n).appendTo(this.container),n.data("splitter",r),i==="hor"&&(f=r.children(".buttons"),r.draggable({axis:"x",opacity:.5,containment:[0,0,0,0],start:function(){var s,h;t.HiddenElement();u.Resizable=!1;o.ReSet();s=st["default"];r.siblings().position({of:t.Canvas,offset:s.offset,my:s.my,at:s.at});f.addClass("buttons-dragging");this.parentWidth=Math.floor(n.parent().width());var c=r.height(),l=n.next(),e=Number(n.attr("sizeunit")),i=Number(l.attr("sizeunit"));e=isNaN(e)?0:e;i=isNaN(i)?0:i;h=i===1;this.settingLayout=h?l:n;this.settingLayoutSizeCondition=h;this.settingLayoutSizeUnit=h?i:e;it.Create({top:r.position().top,height:c-2,lineHeight:c+"px"},e,i)},drag:function(t,i){var o=n.position(),f=n.offset(),r=Math.floor(i.position.left-o.left-5),u=Math.floor(this.parentWidth),s=u-r,e=this.percentSize=Math.floor(r/u*100);this.pixelSize=this.settingLayoutSizeCondition?s:r;this.settingLayout.width(this.pixelSize);it.Covering({option:{left:f.left+5,width:r-12},percent:e},{option:{left:f.left+r+5,width:u-r-12},percent:100-e})},stop:function(){it.Stop();this.settingLayoutSizeUnit===1?this.settingLayout.width(this.pixelSize):this.settingLayout.width(this.percentSize+"%");u.Resizable=!0;t.DoResizeInterval();f.removeClass("buttons-dragging")}})),r},n.CreateSplitter=function(t,i){return n._instance===null&&(n._instance=new n),n._instance.CreateSplitter(t,i)},n.HideAll=function(){n._instance===null&&(n._instance=new n);n._instance.container.find(".layout-splitter").hide()},n.DeleteAll=function(t){n._instance===null&&(n._instance=new n);n._instance.container.empty();$(".design-canvas td,.design-canvas tr").data("splitter",null);t==="ver"&&$(".layout-table,.layout-table .empty-content,.content-placeholder").css({height:"auto","min-height":"100px"})},n._instance=null,n}(),st={hor:{offset:"-5 5",my:"left top",at:"right top"},ver:{offset:"5 -5",my:"left top",at:"left bottom"},"default":{offset:"0 0",my:"left top",at:"left top"}};(function(n){n[n.None=0]="None";n[n.Layout=1]="Layout";n[n.ContentBlock=2]="ContentBlock";n[n.ContentBlockGroup=3]="ContentBlockGroup"})(n.DroppableType||(n.DroppableType={}));pt=n.DroppableType;f=function(){function n(n,t){t===void 0&&(t="");this.Layout=n;this.Name=t}return n.prototype.ActiveLayout=function(){return lt.FireSelection(this.Layout),this.Name==="tab"&&this.Layout.find("> tbody > tr > td > .content-placeholder > .content > dl.tab > dt.tab-pages").sortable({axis:"x",dropOnEmpty:!1,items:".tab-page",opacity:.5,tolerance:"pointer",start:function(n,t){t.helper.trigger("click");this.srcIndex=t.helper.index()},update:function(n,t){var i=t.item.index(),r=t.item.closest(".tab").find(".tab-panel");r.eq(this.srcIndex)[this.srcIndex<i?"insertAfter":"insertBefore"](r.eq(i))}}),n.ActiveDroppable(this.Layout.find(".empty-content")),this.Layout.data("actived",!0),this},n.ActiveDroppable=function(i){return i.droppable({accept:".design-panel-control .design-control-layout-element li,.design-panel-control .design-control-layout-contents li, .design-control-layout-content-group li",activeClass:"drop-active",hoverClass:"drop-hover",addClasses:!1,greedy:!0,activate:function(){},deactivate:function(){$(".drop-active,.drop-hover").removeClass("drop-active drop-hover")},over:function(){},out:function(){},drop:function(i,u){var o=$(this),c=o.parent(),h,a,f,e;switch(Number(u.helper.attr("droptype"))){case 1:h=u.helper.attr("layout");a=c.closest(".layout-table");a.length||c.removeClass("init-size");h&&(f=ot.GetLayout(h),f&&(o.replaceWith(f.Layout),f.ActiveLayout(),f.Layout.find(".layout-table").each(function(){var t=$(this);return new n(t,"").ActiveLayout(),t})));break;case 2:e=new r(u.helper);e&&e.Content&&(r.ActiveDroppable(e),o.replaceWith(e.Content),s.Apply(),t.DoResizeInterval());break;case 3:t.HtmlInitialize(o.parent(),l.GetGroupData(u.helper.attr("key")).html)}}})},n.Delete=function(i){var h,r,o,c,f,l;return u.Resizable=!1,t.HiddenElement(),i!==null&&i.length>0&&(i.hasClass("layout-top")?(h=$(t.EmptyContent),e.DeleteAll(""),i.empty().append(h),n.ActiveDroppable(h)):(r=i.attr("splitter"),r&&(o=r==="hor"?i.siblings():i.closest("tr").siblings(),o.length>0&&(c=r==="hor"?o.children():o.children("td").children(),f=i.closest(".layout-table"),e.DeleteAll(r),t.DoResizeInterval(),l=f.closest("table.layout-table.tab").length>0,f.siblings().length?f.remove():f.replaceWith(c),l&&s.Apply())))),u.Resizable=!0,!1},n}();n.Layout=f;r=function(){function n(t,i){if(this.context=t,this.Template=null,t){var r=Number(t.attr("template"));isNaN(r)||(this.Template=tt.GetTemplate(r));this.Content=$(this.PrevProcessing(n._wrap_format)).attr("contentType",this.Template.contentType);this.LoadContent(i)}}return n.ParseContentBlock=function(t){var i=new n(null);return i.Content=t,i.context=null,i},n.ActiveDroppable=function(i){i.Content.droppable({accept:".design-panel-control .design-control-layout-contents li",addClasses:!1,greedy:!0,tolerance:"pointer",create:function(){},activate:function(){},deactivate:function(){},over:function(){h.Anchor(i.Content)},out:function(){h.Anchor(null)},drop:function(r,u){var f=h.GetDirect(),l,e;if(f!==-1){if(l=f===0||f===1,e=new n(u.draggable),l){var a=f===0||f===2,o=ot.GetLayout("hor"),c=i.Content.clone(),v=a?e.Content:c,y=a?c:e.Content;o.Layout.find("> tbody > tr > td:first > .empty-content").replaceWith(v);o.Layout.find("> tbody > tr > td:last > .empty-content").replaceWith(y);i.Content.replaceWith(o.Layout);n.ActiveDroppable(n.ParseContentBlock(c));o.ActiveLayout()}else f===2?i.Content.before(e.Content):i.Content.after(e.Content),t.DoResizeInterval();n.ActiveDroppable(e)}s.Apply();h.Reset()}})},n.prototype.PrevProcessing=function(i){var f=i,r,u;return this.Template&&(r=this.Template.option,u=$.trim(r.moreurl),f=f.replace(/\{0\}/g,r.ico?r.ico:n._default_content_image).replace(/\{1\}/g,r.title?r.title:n._default_content_title).replace(/\{3\}/g,r.remark).replace(/\{2\}/g,this.LoadOptions()+(this.Template.contentType!==2?'<a href="javascript:void(0)" class="refresh" title="刷新"><img onerror="imgError()" src="../../image/refresh.png" alt="" /><span>刷新<\/span><\/a>':"")+(u?n._func_link_tag.replace(/\{0\}/g,u).replace(/\{1\}/g,t.GetMoreUrl(u)).replace(/\{2\}/g,"0").replace(/\{3\}/g,"0").replace(/\{4\}/g,"more-link").replace(/\{5\}/g,"../../image/more.png").replace(/\{7\}/g,"").replace(/\{6\}/g,"更多"):""))),f},n.prototype.LoadComplete=function(n,t){t===void 0&&(t="");this.Content.removeClass("load-fail");var i=this.Content.children(".content"),r=i.empty().removeClass("content-loading").append(n);i.find(".tab > .tab-pages > .tab-page:first").trigger("click");t!==""&&r.addClass(t);this.Content.siblings().length===0&&this.Content.height()<150&&this.Content.parent("td").height(function(){return"auto"})},n.prototype.LoadFail=function(){this.Content.addClass("load-fail");this.LoadComplete('<img onerror="imgError()" src="../../image/warning.png" alt="" style="vertical-align: middle" /> 内容未能成功加载 ...');this.Content.children(".content").addClass("load-fail-bg")},n.prototype.FormatResourceString=function(n){return n.replace(/\r\n/g,"").replace('\\"','"')},n.prototype.LoadResource=function(t,i){var y=this,c,f,h,r,l,a,v;if(t=this.FormatResourceString(t),c=[],t&&(f=t.match(n._resource_format),f)){var e=[],o=[],s=[];for(h=0;h<f.length;h++)r=f[h],n._outline_script_format.test(r)&&e.push(r),n._inline_script_format.test(r)&&c.push(r),n._outline_style_format.test(r)&&o.push(r),n._inline_style_format.test(r)&&s.push(r);for(l in s)s.hasOwnProperty(l)&&u.Header.append(s[l]);for(a in o)o.hasOwnProperty(a)&&this.Content.queue(i,function(){$.get(o[a].match(n._outline_style_format)[1],undefined,function(t){$(n._style_format.replace(/\{0\}/,t)).on("load",function(){return y.Content.dequeue(i)}).appendTo(u.Header)},"text")});for(v in e)e.hasOwnProperty(v)&&this.Content.queue(i,function(){$.getScript(e[v].match(n._outline_script_format)[1],function(){return y.Content.dequeue(i)})})}return c},n.prototype.PrevLoadResource=function(n,t){var i=[],r;if(n&&n.length)for(r in n)n.hasOwnProperty(r)&&(i=i.concat(this.LoadResource(n[r],t)));return i},n.prototype.AfterLoadResource=function(t,i){var r,u;for(r in i)i.hasOwnProperty(r)&&(u=i[r].match(n._inline_script_format)[1].replace(/GetCurrentContentBlock\s*\(\s*\)/g,'$("div.content-placeholder[resourceindex='+t+']").data("reference")'),$.globalEval("try { "+u+" } catch (_error_message) {  } "))},n.prototype.LoadOptions=function(){var e="",u=this.Template.option.opts,f,i,r;for(f in u)u.hasOwnProperty(f)&&(i=u[f],r=$.trim(i.ico),e+=n._func_link_tag.replace(/\{0\}/g,i.url).replace(/\{1\}/g,t.GetMoreUrl(i.url)).replace(/\{2\}/g,i.width.toString()).replace(/\{3\}/g,i.height.toString()).replace(/\{4\}/g,"").replace(/\{5\}/g,r?"":r).replace(/\{7\}/g,r?"":"hide").replace(/\{6\}/g,i.title));return e},n.prototype.UpdatePager=function(n,t,i,r){var e,h,f;if(!isNaN(t)&&(e=n.find(".title-pager"),e.length)){e.empty();var u=new wt(t,i,r),o="",s='<a href="javascript: void(0)" rel="{1}"{2}>{0}<\/a>';if(u.recordCount){for(o+=s.replace("{0}",'<img onerror="imgError()" src="../../image/first-page.png" alt="上一页" title="上一页" />').replace("{1}",u.prevPage.toString()).replace("{2}",' class="first-page'+(u.pageIndex===u.prevPage?" sel":"")+'"'),h=u.GetPageCodeInterval(3),f=h.start;f<=h.end;f++)o+=s.replace("{0}",f.toString()).replace("{1}",f.toString()).replace("{2}",f===u.pageIndex?' class="sel"':"");o+=s.replace("{0}",'<img onerror="imgError()" src="../../image/last-page.png" alt="下一页" title="下一页" />').replace("{1}",u.nextPage.toString()).replace("{2}",' class="last-page'+(u.pageIndex===u.nextPage?" sel":"")+'"')}e.append(o)}},n.prototype.ReLoad=function(n){this.LoadContent(n)},n.prototype.GetId=function(){return this.Content.attr("resourceindex")},n.GetById=function(n){return $("div.content-placeholder[resourceindex="+n+"]").data("reference")},n.prototype.SetRequestParameter=function(n,t){var r=this.Content.children(".content"),u=r.attr("href");if(u){var f=u.split("?"),e=f[0],i=f[1]||"";i?new RegExp(n+"s*=").test(i)?i.replace(new RegExp(n+"s*=.*?(?:&|$)"),n+"="+t):i+="&"+n+"="+t:i=n+"="+t;r.attr("href",e+"?"+i)}},n.prototype.LoadContent=function(t){var u,s;try{var r=this,c=null,f="",e=this.Content.children(".content"),h=null,o=Number.NaN,l=Number.NaN,v=Number.NaN;this.Template?(c=this.Template.option,f=c.url,e.attr("href",f).attr("originalHref",f),h=this.Template.contentType,r.Content.attr("islist",o=Number(this.Template.option.list)),r.Content.attr("ishead",l=Number(this.Template.option.head)),r.Content.attr("minwidth",v=Number(this.Template.option.minwidth))):(f=e.attr("href"),h=Number(this.Content.attr("contenttype")),o=Number(r.Content.attr("islist")),l=Number(r.Content.attr("ishead")),v=Number(r.Content.attr("minwidth")));o===1||r.Content.find(".title-pager").remove();switch(h){case 0:if(!f){r.LoadFail("");return}u=Number(e.attr("pagesize"));u=isNaN(u)?8:u;s=Number(e.attr("pageIndex"));s=isNaN(s)?1:s;$.when($.ajax({url:f,dataType:"json",data:{IDAjax:!0,ID:i.GetID(),PortalType:i.GetPortalType(),PageSize:u,PageIndex:s,randData:(new Date).getTime()}})).done(function(i){var f,s;i&&i.Success&&i.Success.toLowerCase()==="y"?(f=r.Content.attr("resourceindex"),f||(f="ResourceLoader"+String(n.ResourceIndex++),r.Content.attr("resourceindex",f).data("reference",r)),s=r.PrevLoadResource(i.Others,f),r.Content.queue(f,function(){r.LoadComplete(i.Data);r.Content.dequeue(f)}).queue(f,function(){r.AfterLoadResource(f,s);r.Content.dequeue(f)}).queue(f,function(){o===1&&r.UpdatePager(r.Content,Number(i.Others[1]),u,Number(i.Others[0]));r.Content.dequeue(f)}).queue(f,function(){o===1&&e.css("min-height",(u+(e.find("> .table > thead").length>0?1:0))*30+"px");r.Content.attr("contentscrolling")==="true"&&a.ApplyContentScrolling(r.Content);r.Content.dequeue(f)}).queue(f,function(){t&&$.isFunction(t)&&t();r.Content.dequeue(f)}).dequeue(f)):r.LoadFail(i)}).fail(function(n){r.LoadFail(n)});return;case 1:this.LoadComplete('<iframe class="iframe-page" src="about:blank" frameborder="0"><\/iframe>');return;case 2:this.LoadComplete("","custom-content-block");return;case 3:this.LoadComplete("","image-content-block");return}r.LoadFail("")}catch(y){}},n._wrap_format='<div class="content-placeholder theme-gray" remark="{3}"><img onerror="imgError()" class="setting" src="../../image/setting.png" alt="高级配置" title="高级配置" /><div class="title"><img onerror="imgError()" class="title-image" src="{0}" alt="折叠/展示内容块" title="折叠/展示内容块" /><span class="title-span" title="{1} - 双击此处编辑标题">{1}<\/span><div class="title-func">{2}<\/div><div class="title-pager"><\/div><\/div><div class="content content-loading"><div class="loading-box"><img onerror="imgError()" class="loading" src="../../image/loading.gif" alt="" /><\/div><\/div><\/div>',n._default_content_image="../../image/content-default.png",n._default_content_title="尚无标题",n._resource_format=/(\<style.*?\>[\s\S]*?\<\/style\>)|(\<link.*?\>)|(\<script.*?\>[\s\S]*?\<\/script\>)/ig,n._outline_script_format=/\<script.*?src\s*\=\s*['"]+(.*?)['"]+.*?\>[\s\S]*?\<\/script\>/i,n._inline_script_format=/\<script.*?\>([\s\S]*?)\<\/script\>/i,n._outline_style_format=/\<link.*?href\s*\=\s*['"]+(.*?)['"]+.*?\>/i,n._inline_style_format=/\<style.*?\>([\s\S]*?)\<\/style\>/i,n._outline_style_tag='<link rel="stylesheet" href="{0}" />',n._func_link_tag='<a dataurl="{1}" url="{1}" href="javascript:void(0)" onclick="javascript:openWindow(this.url, {2}, {3});return false;" rel="{0}" opensize="{2}, {3}" class="{4}"><img onerror="imgError()" src="{5}" class="{7}" title="{6}" alt="{6}" /><span>{6}<\/span><\/a>',n.ResourceIndex=0,n._style_format='<style type="text/css">{0}<\/style>',n}();n.ContentBlock=r;var s=function(){function n(){}return n.Apply=function(){var n=$(".content-placeholder");n.removeClass("specify-content-placeholder");n.find("> .content .tab > .tab-panel > :only-child.content-placeholder").addClass("specify-content-placeholder")},n}(),wt=function(){function n(n,t,i){this.pageIndex=n;this.pageSize=t;this.recordCount=i;this.prevPage=0;this.nextPage=0;this.pageCount=0;this.pageIndex=isNaN(this.pageIndex)||this.pageIndex<1?1:this.pageIndex;this.pageSize=isNaN(this.pageSize)||this.pageSize<1?1:this.pageSize;this.recordCount=isNaN(this.recordCount)||this.recordCount<0?0:this.recordCount;this.Comput()}return n.prototype.Comput=function(){if(this.recordCount===0){this.pageCount=this.pageIndex=this.prevPage=this.nextPage=1;return}this.pageCount=Math.ceil(this.recordCount/this.pageSize);this.pageCount=this.pageCount<1?1:this.pageCount;this.pageIndex=this.pageIndex>this.pageCount?this.pageCount:this.pageIndex;this.prevPage=this.pageIndex<=1?1:this.pageIndex-1;this.nextPage=this.pageIndex>=this.pageCount?this.pageCount:this.pageIndex+1},n.prototype.GetMidValue=function(n){return n%2!=0?(n+1)/2:n/2},n.prototype.GetStartCode=function(n,t){return this.pageIndex+t>this.pageCount?this.pageIndex-(n-(this.pageCount-this.pageIndex+1)):this.pageIndex-(t-1)},n.prototype.GetEndCode=function(n,t){var i=this.pageIndex<t?n:this.pageIndex+t-1;return i>this.pageCount?this.pageCount:i},n.prototype.GetPageCodeInterval=function(n){var t,i;return n=n>1?n:1,t={start:1,end:1},n<=1?(t.start=this.pageIndex,t.end=this.pageIndex):(i=this.GetMidValue(n),t.start=this.GetStartCode(n,i),t.end=this.GetEndCode(n,i)),t.start=t.start<1?1:t.start,t.end=t.end<1?1:t.end,t},n}(),bt=function(){function n(){var u=this,h,i;this.shortcutMenu=null;this.TargetContent=null;this.shortcutMenu=$(".setting-shortcut-menu");this.shortcutMenu.on("blur",function(){return u.TargetContent=null,u.shortcutMenu.hide(),!1}).on("mouseenter",function(){u.shortcutMenu.off("blur")}).on("mouseleave",function(){u.shortcutMenu.on("blur",function(){return u.TargetContent=null,u.shortcutMenu.hide(),!1})});h=this.shortcutMenu.find(".setting-toggle-title");h.on("click",function(){var n=u.TargetContent.children(".title"),t=n.css("display")==="none";u.TargetContent!==null&&(t?(h.text("隐藏标题栏"),n.show(),u.TargetContent.addClass("theme-gray")):(h.text("显示标题栏"),n.hide(),u.TargetContent.removeClass("theme-blue theme-gray")),u.shortcutMenu.hide())});this.shortcutMenu.find(".setting-background-blue").on("click",function(){u.TargetContent!==null&&(u.TargetContent.removeAttr("style").removeClass("theme-gray theme-tran").addClass("theme-blue").children(".title").show(),u.TargetContent.find(".title,.title *,.bottom,.bottom *").removeAttr("style"),u.shortcutMenu.hide())});this.shortcutMenu.find(".setting-background-gray").on("click",function(){u.TargetContent!==null&&(u.TargetContent.removeAttr("style").removeClass("theme-blue theme-tran").addClass("theme-gray").children(".title").show(),u.TargetContent.find(".title,.title *,.bottom,.bottom *").removeAttr("style"),u.shortcutMenu.hide())});this.shortcutMenu.find(".setting-background-none").on("click",function(){u.TargetContent!==null&&(u.TargetContent.removeAttr("style").removeClass("theme-blue theme-gray").addClass("theme-tran"),u.TargetContent.find(".title,.title *,.bottom,.bottom *").removeAttr("style"),u.shortcutMenu.hide())});var n=$(".page-setting-box"),d=n.width(),o=$(window);o.on("resize scroll",function(){n.css("display")!=="none"&&n.stop().animate({left:(o.width()-d)/2,top:o.scrollTop()+(o.height()-n.height())/2},300,"swing")});var l=n.find(".pager-setting-box-slider"),c=n.find(".quick-setting-box-slider"),v=n.find(".auto-refresh-setting-box-slider"),p=n.find(".content-scrolling-box-slider"),w=n.find(".default-show-setting-box-slider"),k=n.find(".height-setting-box-slider");n.find(".setting-dialog-btns-cancel").on("click",function(){k.hide();l.hide();c.hide();v.hide();p.hide();w.hide();n.hide()});i=this;n.find(".is-show-title-icon").on("click",function(){i.TargetContent!==null&&($(this).attr("checked")==="checked"?i.TargetContent.find("> .title > .title-image").show():i.TargetContent.find("> .title > .title-image").hide())});n.find(".is-show-pager").on("click",function(){i.TargetContent!==null&&($(this).attr("checked")==="checked"?(i.TargetContent.find(".title-pager").show(),n.find(".is-use-content-scrolling").attr({checked:!1,disabled:"disabled"})):(i.TargetContent.find(".title-pager").hide(),n.find(".is-use-content-scrolling").attr({disabled:!1})))});n.find(".is-use-auto-refresh").on("click",function(){var r,t;i.TargetContent!==null&&(r=$(this).attr("checked")==="checked",i.TargetContent.attr("autorefresh",r.toString()),r?(t=Number(i.TargetContent.attr("refreshinterval")),isNaN(t)&&(t=60,i.TargetContent.attr("refreshinterval","60"),n.find(".auto-refresh-interval").val("60")),y.ApplyAutoRefresh(i.TargetContent,t)):y.CancelAutoRefresh(i.TargetContent))});n.find(".is-use-content-scrolling").on("click",function(){if(i.TargetContent!==null){var t=$(this).attr("checked")==="checked",r=n.find(".is-show-pager");i.TargetContent.attr("contentscrolling",t.toString());t?(r.attr({checked:!1,disabled:"disabled"}),i.TargetContent.find(".title-pager").hide(),a.ApplyContentScrolling(i.TargetContent)):(r.attr({disabled:!1}),a.CancelContentScrolling(i.TargetContent))}});n.find(".is-show-quick-btns").on("click",function(){i.TargetContent!==null&&($(this).attr("checked")==="checked"?i.TargetContent.find(".title-func").show():i.TargetContent.find(".title-func").hide())});n.find(".auto-refresh-interval").on("blur",function(){if(i.TargetContent!==null){var r=$(this),u=$.trim(r.val()),t=Number(u);t=isNaN(t)||t<60?60:t;r.val(t.toString());i.TargetContent.attr("refreshinterval",t.toString());n.find(".is-use-auto-refresh").attr("checked")==="checked"&&y.ApplyAutoRefresh(i.TargetContent,t)}}).on("focus",function(){$(this).select()});n.find(".page-size").on("blur",function(){var u,t;if(i.TargetContent!==null&&i.TargetContent.attr("contenttype")==="0"){var f=$(this),e=$.trim(f.val()),n=Number(e);n=isNaN(n)||n<1?8:n;f.val(n.toString());u=i.TargetContent.children(".content");t=Number(u.attr("pagesize"));t=isNaN(t)||t<1?8:t;n!==t&&(u.attr("pagesize",n),r.ParseContentBlock(i.TargetContent).LoadContent())}}).on("focus",function(){$(this).select()});n.find(".page-index").on("blur",function(){var u,t;if(i.TargetContent!==null&&i.TargetContent.attr("contenttype")==="0"){var f=$(this),e=$.trim(f.val()),n=Number(e);n=isNaN(n)||n<1?1:n;f.val(n.toString());u=i.TargetContent.children(".content");t=Number(u.attr("pageindex"));t=isNaN(t)||t<1?8:t;n!==t&&(u.attr("pageindex",n),r.ParseContentBlock(i.TargetContent).LoadContent())}}).on("focus",function(){$(this).select()});n.find(".system-btn-refresh-link").on("click",function(){i.TargetContent!==null&&i.TargetContent.attr("contenttype")!=="2"&&($(this).attr("checked")==="checked"?i.TargetContent.find(".title-func > .refresh").show():i.TargetContent.find(".title-func > .refresh").hide())});n.find(".system-btn-help-link").on("click",function(){if(i.TargetContent!==null){var n=i.TargetContent.find(".title-func > .help");$(this).attr("checked")==="checked"?i.TargetContent.find(".title-func").append('<a href="javascript: void(0)" class="help"><img onerror="imgError()" src="../../image/cb-help.png" alt="帮助" /><span>帮助<\/span><\/a>'):n.remove()}});n.find(".system-btn-more-link").on("click",function(){i.TargetContent!==null&&i.TargetContent.attr("contenttype")==="0"&&($(this).attr("checked")==="checked"?i.TargetContent.find(".title-func > .more-link").show():i.TargetContent.find(".title-func > .more-link").hide())});n.find(".pager-on-position-top").on("click",function(){var t=i.TargetContent.find("> .title"),u=t.find("> .title-pager"),n=i.TargetContent.find("> .bottom"),r=n.find("> .title-pager");!u.length&&r.length&&r.appendTo(t);n.children().length===0&&n.remove()});n.find(".pager-on-position-bottom").on("click",function(){var u=i.TargetContent.find("> .title"),t=u.find("> .title-pager"),n=i.TargetContent.find("> .bottom"),r;n&&n.length||(n=$('<div class="bottom"><\/div>'),n.appendTo(i.TargetContent));r=n.find("> .title-pager");!r.length&&t.length&&t.appendTo(n)});n.find(".quick-on-position-top").on("click",function(){var t=i.TargetContent.find("> .title"),u=t.find("> .title-func"),n=i.TargetContent.find("> .bottom"),r=n.find("> .title-func");!u.length&&r.length&&r.appendTo(t);n.children().length===0&&n.remove()});n.find(".quick-on-position-bottom").on("click",function(){var u=i.TargetContent.find("> .title"),t=u.find("> .title-func"),n=i.TargetContent.find("> .bottom"),r;n&&n.length||(n=$('<div class="bottom"><\/div>'),n.appendTo(i.TargetContent));r=n.find("> .title-func");!r.length&&t.length&&t.appendTo(n)});n.find(".height-setting-box-slider .content-height").on("blur",function(){if(i.TargetContent!==null&&Number(i.TargetContent.attr("islist"))!==1){var t=$(this),r=$.trim(t.val()),n=Number(r);!isNaN(n)&&n>29?i.TargetContent.css("cssText","height: "+n+"px !important"):t.val(String(i.TargetContent.height()))}}).on("focus",function(){$(this).select()});this.shortcutMenu.find(".setting-color-scheme").on("click",function(){b.Show(i.TargetContent);u.shortcutMenu.hide()});this.shortcutMenu.find(".setting-background-pageSetting").on("click",function(){var f,e,y,b,t,g,r,s,h,a,nt;$(".setting-dialog").hide();k.hide();l.hide();c.hide();v.hide();p.hide();w.hide();u.TargetContent!==null?(Number(u.TargetContent.attr("islist"))!==1&&(k.show(),n.find(".height-setting-box-slider .content-height").val(String(u.TargetContent.height()))),f=i.TargetContent.attr("contenttype"),n.find(".is-show-title-icon").attr("checked",(u.TargetContent.find("> .title > .title-image:visible").length>0).toString()),f==="0"&&(v.show(),p.show(),n.find(".is-use-content-scrolling").removeAttr("checked").removeAttr("disabled"),n.find(".is-show-pager").removeAttr("disabled"),e=u.TargetContent.find(".title-pager"),e&&e.length?(l.show(),y=e.css("display")!=="none",n.find(".is-show-pager").attr("checked",y.toString()).parent().show(),n.find(".pager-on-position-box").show(),u.TargetContent.find("> .title > .title-pager").length&&n.find(".pager-on-position-top").attr("checked","checked"),u.TargetContent.find("> .bottom > .title-pager").length&&n.find(".pager-on-position-bottom").attr("checked","checked"),y?(u.TargetContent.attr("contentscrolling","false"),n.find(".is-use-content-scrolling").attr({checked:!1,disabled:!0})):n.find(".is-use-content-scrolling").removeAttr("disabled")):(n.find(".is-show-pager").removeAttr("checked").parent().hide(),n.find(".pager-on-position-box").hide()),b=u.TargetContent.find(".content"),t=Number(b.attr("pagesize")),n.find(".page-size").val(String(isNaN(t)||t===0?8:t)),g=Number(b.attr("pageindex")),n.find(".page-index").val(String(isNaN(g)||t===0?1:g)),u.TargetContent.attr("contentscrolling")==="true"&&(n.find(".is-use-content-scrolling").attr("checked","checked"),n.find(".is-show-pager").attr({checked:!1,disabled:!0}),u.TargetContent.find(".title-pager").hide()),r=Number(u.TargetContent.attr("refreshinterval")),r=isNaN(r)?60:r,n.find(".auto-refresh-interval").val(r.toString()),n.find(".is-use-auto-refresh").attr("checked",(u.TargetContent.attr("autorefresh")==="true").toString())),f==="1"?n.find(".system-btn-more-link-box").hide():n.find(".system-btn-more-link-box").show(),f!=="2"?(s=u.TargetContent.find(".title-func"),s&&s.length?(n.find(".is-show-quick-btns").attr("checked",(s.css("display")!=="none").toString()).parent().show(),c.show()):(n.find(".is-show-quick-btns").removeAttr("checked").parent().hide(),c.hide()),u.TargetContent.find("> .title > .title-func").length?n.find(".quick-on-position-top").attr("checked","checked"):n.find(".quick-on-position-top").removeAttr("checked"),u.TargetContent.find("> .bottom > .title-func").length?n.find(".quick-on-position-bottom").attr("checked","checked"):n.find(".quick-on-position-bottom").removeAttr("checked"),h=u.TargetContent.find(".title-func > .more-link"),h&&h.length?n.find(".system-btn-more-link").attr("checked",(h.css("display")!=="none").toString()).parent().show():n.find(".system-btn-more-link").removeAttr("checked").parent().hide(),a=u.TargetContent.find(".title-func > .refresh"),a&&a.length?n.find(".system-btn-refresh-link").attr("checked",(a.css("display")!=="none").toString()).parent().show():n.find(".system-btn-refresh-link").removeAttr("checked").parent().hide(),nt=u.TargetContent.find(".title-func > .help"),nt&&nt.length?n.find(".system-btn-help-link").attr("checked","checked"):n.find(".system-btn-help-link").removeAttr("checked")):w.show(),n.css({left:(o.width()-d)/2,top:(o.height()+o.scrollTop()-n.height()-50)/2}).show(),o.trigger("resize"),u.shortcutMenu.hide()):n.hide()});this.shortcutMenu.find(".setting-delete-contentblock").on("click",function(){var r,n,i;u.TargetContent!==null&&(u.TargetContent.siblings().length?(r=u.TargetContent.closest("table.layout-table.tab").length>0,u.TargetContent.remove(),r&&s.Apply()):(n=$(t.EmptyContent),i=u.TargetContent.parent("td").parent("tr").parent("tbody").parent("table.layout-table.tab"),i.length?(i.replaceWith(n),e.DeleteAll("ver")):u.TargetContent.replaceWith(n),f.ActiveDroppable(n)),u.shortcutMenu.hide(),t.Canvas.trigger("resize"),t.DoResizeInterval())})}return n.GetInstance=function(){return n._instance===null&&(n._instance=new n),n._instance},n.prototype.Anchor=function(n,t){var i=t.offset();i.top+=24;i.left-=129;this.shortcutMenu.css(i).find(".setting-toggle-title").text(n.children(".title").css("display")==="none"?"显示标题栏":"隐藏标题栏");this.shortcutMenu.slideDown(100).focus();this.TargetContent=n},n.Anchor=function(t,i){n.GetInstance().Anchor(t,i)},n._instance=null,n}(),kt=function(){function n(){}return n.GetBox=function(){if(n.box===null){var t=n.box=$(".content-group-name-box"),i=$(window),r=t.find(".input");i.on("resize scroll",function(){t.css("display")!=="none"&&t.show().stop().animate({left:(i.width()-t.width())/2,top:(i.height()-t.height())/2+i.scrollTop()},300,"swing")});t.find(".btn-apply").on("click",function(){var i=r.val();i=$.trim(i);i?(l.CreateGroup(i,n.html),t.hide()):(alert("请输入内容块组的名称。"),r.focus().select())});t.find(".btn-cancel").on("click",function(){t.hide()})}return n.box},n.Show=function(t){t=$.trim(t);var i=n.GetBox(),r=$(window);t&&(n.html=t,i.show().stop().animate({left:(r.width()-i.width())/2,top:(r.height()-i.height())/2+r.scrollTop()},300,"swing"),i.find(".input").focus().val(""))},n.box=null,n.html="",n}(),o=function(){function n(){var n=this;this.cover=null;this.box=null;this.target=null;this.btnDel=null;this.btnSaveAsGroup=null;this.btnWidthSetting=null;this.btnClose=null;this.cover=$(".layout-setting-cover");this.box=$(".layout-setting-buttons-box");this.btnDel=this.box.find(".setting-btn-delete-layout");this.btnClose=this.box.find(".setting-btn-close");this.btnSaveAsGroup=this.box.find(".setting-btn-save-as-group");this.btnWidthSetting=this.box.find(".setting-btn-pixed");this.btnClose.on("click",function(){return n.ReSet()});this.btnDel.on("click",function(){n.target&&n.target.length&&(f.Delete(n.target),n.ReSet())});this.btnWidthSetting.on("click",function(){n.target&&n.target.length&&(n.target.trigger("dblclick"),n.ReSet())});this.btnSaveAsGroup.on("click",function(){n.target&&n.target.length&&(kt.Show(c.CanvasStatic.GetFinalOutputHTML(n.target)),n.ReSet())})}return n.prototype.ReSet=function(){this.target=null;this.cover&&this.cover.hide();this.box&&this.box.hide()},n.prototype.Attach=function(n){if(n&&n.length){this.target=n;var t={width:n.width()-12,height:n.height()-12};this.cover.css(t).show().position({of:n,offset:"5 5",my:"left top",at:"left top"});this.box.css(t).show().position({of:n,offset:"5 5",my:"left top",at:"left top"});n.find(".content-placeholder").length>1?this.btnSaveAsGroup.show():this.btnSaveAsGroup.hide();n.closest(".layout-table").hasClass("hor")?this.btnWidthSetting.val(Number(n.attr("sizeunit"))===1?"设置为百分比宽度":"设置为固定像素宽度").show():this.btnWidthSetting.hide()}},n.ReSet=function(){n.GetInstance().ReSet()},n.GetInstance=function(){return n._instance===null&&(n._instance=new n),n._instance},n.Attach=function(t){n.GetInstance().Attach(t)},n._instance=null,n}(),ht=function(){function n(){this.Box=null;this.Text=null;this.timer=Number.NaN;this.Box=$(".min-width-info-box");this.Box.find(".prompt-cover").css("opacity",.3);this.Text=this.Box.find(".prompt-text > span")}return n.prototype.Anchor=function(n){var u=this,t=Number(n.attr("minwidth")),i=n.position(),r={width:n.width(),height:n.height()};this.Box.hide();isNaN(this.timer)||window.clearTimeout(this.timer);this.Text.text(!isNaN(t)&&t!==0?t+"px":"(未配置)");this.timer=window.setTimeout(function(){return u.Box.hide()},3e3);this.Box.css({left:i.left+(r.width/2-58),top:i.top+(r.height/2+36)}).show()},n.GetInstance=function(){return n.mb===null&&(n.mb=new n),n.mb},n.Anchor=function(t){t.hasClass("content-placeholder")&&n.GetInstance().Anchor(t)},n.Hide=function(){var t=n.GetInstance();t.Box.hide();isNaN(t.timer)||window.clearTimeout(t.timer)},n.mb=null,n}(),dt=function(){function n(){var n=this,i,r;this.editor=null;i=this.box=$(".custom-content-text-area");r=$(window);r.on("resize scroll",function(){i.css("display")!=="none"&&i.stop().animate({left:(r.width()-i.width())/2,top:(r.height()-i.height())/2+r.scrollTop()},300,"swing")});this.editor=this.box.find(".text-area textarea").xheditor({tools:"full",skin:"nostyle",layerShadow:1,showBlocktag:!0,linkTag:!0,internalScript:!0,inlineScript:!0,internalStyle:!0,inlineStyle:!0,width:"100%",height:300,forcePtag:!1,cleanPaste:2,html5Upload:!1,upMultiple:1});this.box.find(".btn-cancel").on("click",function(){return n.box.hide()});this.box.find(".btn-clear").on("click",function(){return n.editor.setSource("")});this.box.find(".btn-apply").on("click",function(){n.target&&n.target.length>0&&(n.target.html(n.editor.getSource()),t.AutoBinding());n.box.hide()})}return n.GetInstance=function(){return n._instance===null&&(n._instance=new n),n._instance},n.prototype.Show=function(n,t){var i=$(window);this.target=n;this.editor.setSource(t||"");this.box.show().stop().animate({left:(i.width()-this.box.width())/2,top:(i.height()-this.box.height())/2+i.scrollTop()-50},300,"swing")},n.Show=function(t,i){n.GetInstance().Show(t,i)},n._instance=null,n}(),p=function(){function n(){var n=this;this.Target=null;this.Setting=null;this.Showing=!1;this.Setting=$(".custom-content-page");this.Setting.on("click",function(){n.Setting.hide();n.Showing=!0;dt.Show(n.Target,n.Target.html())});this.Setting.on("mouseenter",function(){n.Setting.show();n.Showing=!0});this.Setting.on("mouseout",function(){n.Showing=!1})}return n.GetInstance=function(){return n._instance===null&&(n._instance=new n),n._instance},n.prototype.Anchor=function(n){if(n&&n.length){var t=n.offset();t.left+=1;t.top+=1;this.Setting.css(t);this.Setting.width(n.width()-4);this.Target=n;this.Setting.show()}},n.prototype.Reset=function(){this.Showing||this.Setting.hide()},n.Anchor=function(t){n.GetInstance().Anchor(t)},n.Reset=function(){n.GetInstance().Reset()},n._instance=null,n}(),w=function(){function n(){var n=this;this.Target=null;this.Setting=null;this.UrlBox=null;this.HeightBox=null;this.Showing=!1;this.Selecting=null;this.Setting=$(".frame-page");this.UrlBox=this.Setting.find(".frame-address-url");this.HeightBox=this.Setting.find(".frame-height");this.Setting.on("mouseenter",function(){n.Setting.show();n.Showing=!0});this.Setting.on("mouseout",function(){n.Showing=!1});this.UrlBox.on("keyup",function(t){t.keyCode===13&&n.Target&&(n.Target.attr("src",n.getUrl($.trim(n.UrlBox.val()))),n.Setting.hide())}).on("focus",function(){n.UrlBox.select();n.Selecting=n.UrlBox});this.HeightBox.on("keyup",function(t){t.keyCode===13&&n.Target&&n.Target.css("height",n.getHeight($.trim(n.HeightBox.val())))}).on("focus",function(){n.HeightBox.select();n.Selecting=n.HeightBox})}return n.prototype.getHeight=function(n){if(n){var t=Number(n);return isNaN(t)?"150":t.toString()}return"150"},n.prototype.getUrl=function(n){return n?new RegExp("^([a-z]{2,6})://.+","i").test(n)?n:"http://"+n:"about:blank"},n.prototype.Reset=function(){this.Showing||this.Setting.hide()},n.prototype.Anchor=function(n){var t,i;n&&n.length&&(t=n.offset(),t.left+=1,t.top+=1,this.Setting.css(t),this.Setting.width(n.width()-2),this.Target=n,i=n.attr("src"),i&&this.UrlBox.val(i==="about:blank"?"http://":i),this.Selecting&&this.Selecting.select(),this.HeightBox.val(n.css("height").replace(/px|\%/g,"")),this.Setting.show())},n.GetInstance=function(){return n._instance===null&&(n._instance=new n),n._instance},n.Anchor=function(t){n.GetInstance().Anchor(t)},n.Reset=function(){n.GetInstance().Reset()},n._instance=null,n}(),i=function(){function n(){}return n.GetID=function(){if(!n._id){var t=document.location.search.match(/id\=(.*?)(?:&|$)/i);n._id=t?t[1]:null}return n._id},n.GetPortalType=function(){if(isNaN(n._portalType)){var t=document.location.search.match(/portaltype\=(\d+?)(?:&|$)/i);n._portalType=t?Number(t[1]):Number.NaN}return n._portalType},n.GetPortalId=function(){if(!n._portalId){var t=document.location.search.match(/portal\=(.*?)(?:&|$)/i);n._portalId=t?t[1]:null}return n._portalId},n._id=null,n._portalType=Number.NaN,n._portalId=null,n}(),h=function(){function n(){this.DraggingContentBlock=null;this.DroppingContentBlock=null;this.Direct=-1;this.block=$(".content-placeholder-dragging-indicator")}return n.prototype.Reset=function(){this.DraggingContentBlock=null;this.DroppingContentBlock=null;this.Direct=-1;this.block.hide()},n.prototype.Update=function(n){if(this.DraggingContentBlock&&this.DraggingContentBlock.length&&this.DroppingContentBlock&&this.DroppingContentBlock.length){var u=this.DropPosition,f=this.DropSize,i=n.left-u.left+10,r=n.top-u.top+10,e=f.width-i,o=f.height-r,t={};t["ds"+i]=0;t["ds"+r]=2;t["ds"+e]=1;t["ds"+o]=3;this.Direct=t["ds"+Math.min(i,e,r,o)];this.block.css(this.DirectPosition[this.Direct]);this.block.show()}},n.GetInstance=function(){return n.indicator===null&&(n.indicator=new n),n.indicator},n.Reset=function(){n.GetInstance().Reset()},n.Create=function(t){n.GetInstance().DraggingContentBlock=t},n.Anchor=function(t){var i=n.GetInstance(),r,u;i.DroppingContentBlock=t;t===null?i.block.hide():(r=t.width()+1,u=t.height()+2,i.DropPosition=t.offset(),i.DropSize={width:r,height:u},i.DirectPosition=[{left:i.DropPosition.left,top:i.DropPosition.top,width:4,height:u},{left:i.DropPosition.left+r-3,top:i.DropPosition.top,width:4,height:u},{left:i.DropPosition.left,top:i.DropPosition.top,width:r,height:4},{left:i.DropPosition.left,top:i.DropPosition.top+u-4,width:r,height:4}])},n.UpdateIndicator=function(t){n.GetInstance().Update(t)},n.GetDirect=function(){return n.GetInstance().Direct},n.indicator=null,n}(),ct=function(){function n(){this.Attach=null;this.TextBox=null;this.Callback=null;this.TextBox=$(".text-cover");var n=this;this.TextBox.on("blur",function(){n.applyChange()}).on("keyup",function(t){t.keyCode===13&&n.applyChange()})}return n.prototype.reset=function(){this.Attach=null;this.TextBox.val("").hide().attr("class","text-cover");this.Callback=null},n.prototype.applyChange=function(){if(this.Attach){var t=this.Attach.text(),n=$.trim(this.TextBox.val());n=n?n:t;this.Attach.text(n);this.Callback&&this.Callback(n,t);this.reset()}},n.GetInstance=function(){return n._instance===null&&(n._instance=new n),n._instance},n.Anchor=function(t,i,r,u,f){var e,o,s;t&&t.length&&(e=n.GetInstance(),o=t.offset(),e.Attach=t,e.TextBox.css(i?i:{left:o.left+1,top:o.top+1}),r?e.TextBox.width(r.width).height(r.height).css("line-height",r.height+"px"):(s=t.height(),e.TextBox.width(t.width()+10).height(s).css("line-height",s+"px")),f&&e.TextBox.addClass(f),e.Callback=u?u:null,e.TextBox.val(t.text()).show().focus().select())},n._instance=null,n}(),lt=function(){function n(){}return n.FireSelection=function(t){t===void 0&&(t=null);var i=t===null?$(n._selector):t.find(n._selector);i.trigger("click")},n.ApplyBinding=function(){var i=$(".delete-tab-page");t.Canvas.on("click",".tab > .tab-pages > .tab-page",function(){e.HideAll();var n=$(this),i=n.siblings(".tab-page"),r=n.closest(".tab"),u=r.children(".tab-panel");n.addClass("sel");i.removeClass("sel");u.hide().eq(n.index()).show();t.DoResizeInterval()}).on("dblclick",".tab > .tab-pages > .tab-page",function(){ct.Anchor($(this))}).on("mouseenter",".tab > .tab-pages",function(){t.HiddenElement()}).on("click",".tab > .tab-pages > .tab-page > .delete-tab-page",function(){var i=$(this).parent(),u=i.siblings(".tab-page");if(u.length>0){var o=i.index(".tab-page"),s=i.closest(".tab").find(".tab-panel:eq("+o+")"),r=i.next(".tab-page");r=r.length===0?i.prev():r;i.remove();s.remove();i.hasClass("sel")&&r.trigger("click")}else i.closest(".layout-table.tab").replaceWith(f.ActiveDroppable($(n._empty_content))),e.DeleteAll("ver"),t.DoResizeInterval()}).on("mouseenter",".tab > .tab-pages > .tab-page",function(){var n=$(this).children(".delete-tab-page");n.length===0&&i.clone().appendTo(this)}).on("click",".tab > .tab-pages > .add",function(){var t=$(this),r=t.closest(".tab"),u=t.siblings(".tab-page"),e=$(n._tab_page_format.replace(/\{0\}/g,(u.length+1).toString())),i=$(n._panel_format);f.ActiveDroppable(i.children(".empty-content"));t.before(e);r.append(i)});n.FireSelection()},n._selector=".tab > .tab-pages > .tab-page.sel",n._tab_page_format='<a class="tab-page" hidefocus href="javascript:void(0)">标签{0}<\/a>',n._panel_format='<dd class="tab-panel layout-top"><div class="empty-content"><\/div><\/dd>',n._empty_content=t.EmptyContent,n}(),gt=function(){function n(){this.$obj=$(".portal-page-size")}return n}(),rt=function(){function n(){var t=this,n;this.AttachLayout=null;this.toolbar=$(".layout-quick-toolbar").on("mouseenter",function(){return t.toolbar.show()});n=this.toolbar.find(".size-data");this.SpanText=n.children("span");this.IText=n.children("i");this.Q=n.children("q");this.toolbar.find(".delete-layout").on("click",function(){return f.Delete(t.AttachLayout)})}return n.Anchor=function(t){var i,f,r,e;try{i=n._instance;i===null&&(i=n._instance=new n);f=i.toolbar;r=t.parent();i.AttachLayout=r;var o=r.width(),s=o-12,l=r.parent().width(),h=Math.floor(o/l*100),u=Number(r.attr("sizeunit")),c=r.attr("splitter")==="ver";f.css(t.offset());u=isNaN(u)?0:u;e=u===0;i.SpanText.text(e&&!c?h+"%":s+"Px");i.IText.text(e?s+"Px":h+"%");c?(i.IText.hide(),i.Q.hide()):(i.IText.show(),i.Q.show());f.width(t.width()).show()}catch(a){}},n.Hide=function(){var t=n._instance;t===null&&(t=n._instance=new n);t.toolbar.hide()},n._instance=null,n}()})(t=n.PortalDesign||(n.PortalDesign={}))})(Sapi||(Sapi={}));$(function(){return(new Sapi.PortalDesign.DesignView).Init()});